<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.util</a> &gt; <span class="el_source">TypeUtils.java</span></div><h1>TypeUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.util;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.PropertyNamingStrategy;
import com.alibaba.fastjson.annotation.JSONField;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.parser.DefaultJSONParser;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONScanner;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.deserializer.EnumDeserializer;
import com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer;
import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;
import com.alibaba.fastjson.serializer.CalendarCodec;
import com.alibaba.fastjson.serializer.SerializeBeanInfo;
import com.alibaba.fastjson.serializer.SerializerFeature;

import java.io.InputStream;
import java.io.Reader;
import java.lang.annotation.Annotation;
import java.lang.reflect.*;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.sql.Clob;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.concurrent.Callable;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * @author wenshao[szujobs@hotmail.com]
 */
<span class="fc" id="L54">public class TypeUtils {</span>
<span class="fc" id="L55">    private static final Pattern NUMBER_WITH_TRAILING_ZEROS_PATTERN = Pattern.compile(&quot;\\.0*$&quot;);</span>

<span class="fc" id="L57">    public static boolean compatibleWithJavaBean = false;</span>
    /**
     * 根据field name的大小写输出输入数据
     */
<span class="fc" id="L61">    public static boolean compatibleWithFieldName = false;</span>
<span class="fc" id="L62">    private static boolean setAccessibleEnable = true;</span>
<span class="fc" id="L63">    private static boolean oracleTimestampMethodInited = false;</span>
    private static Method oracleTimestampMethod;
<span class="fc" id="L65">    private static boolean oracleDateMethodInited = false;</span>
    private static Method oracleDateMethod;
<span class="fc" id="L67">    private static boolean optionalClassInited = false;</span>
    private static Class&lt;?&gt; optionalClass;
<span class="fc" id="L69">    private static boolean transientClassInited = false;</span>
    private static Class&lt;? extends Annotation&gt; transientClass;

<span class="fc" id="L72">    private static Class&lt;? extends Annotation&gt; class_OneToMany = null;</span>
<span class="fc" id="L73">    private static boolean class_OneToMany_error = false;</span>
<span class="fc" id="L74">    private static Class&lt;? extends Annotation&gt; class_ManyToMany = null;</span>
<span class="fc" id="L75">    private static boolean class_ManyToMany_error = false;</span>

<span class="fc" id="L77">    private static Method method_HibernateIsInitialized = null;</span>
<span class="fc" id="L78">    private static boolean method_HibernateIsInitialized_error = false;</span>
    private static volatile Class kotlin_metadata;
    private static volatile boolean kotlin_metadata_error;
    private static volatile boolean kotlin_class_klass_error;
    private static volatile Constructor kotlin_kclass_constructor;
    private static volatile Method kotlin_kclass_getConstructors;
    private static volatile Method kotlin_kfunction_getParameters;
    private static volatile Method kotlin_kparameter_getName;
    private static volatile boolean kotlin_error;
    private static volatile Map&lt;Class, String[]&gt; kotlinIgnores;
    private static volatile boolean kotlinIgnores_error;
<span class="fc" id="L89">    private static ConcurrentMap&lt;String, Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String, Class&lt;?&gt;&gt;(256, 0.75f, 1);</span>
    private static Class&lt;?&gt; pathClass;
<span class="fc" id="L91">    private static boolean pathClass_error = false;</span>

<span class="fc" id="L93">    private static Class&lt;? extends Annotation&gt; class_JacksonCreator = null;</span>
<span class="fc" id="L94">    private static boolean class_JacksonCreator_error = false;</span>

<span class="fc" id="L96">    private static volatile Class class_XmlAccessType = null;</span>
<span class="fc" id="L97">    private static volatile Class class_XmlAccessorType = null;</span>
<span class="fc" id="L98">    private static volatile boolean classXmlAccessorType_error = false;</span>
<span class="fc" id="L99">    private static volatile Method method_XmlAccessorType_value = null;</span>
<span class="fc" id="L100">    private static volatile Field field_XmlAccessType_FIELD = null;</span>
<span class="fc" id="L101">    private static volatile Object field_XmlAccessType_FIELD_VALUE = null;</span>

<span class="fc" id="L103">    private static Class class_deque = null;</span>

    static {
        try {
<span class="fc" id="L107">            TypeUtils.compatibleWithJavaBean = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHJAVABEAN));</span>
<span class="fc" id="L108">            TypeUtils.compatibleWithFieldName = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHFIELDNAME));</span>
<span class="nc" id="L109">        } catch (Throwable e) {</span>
            // skip
<span class="fc" id="L111">        }</span>

        try {
<span class="fc" id="L114">            class_deque = Class.forName(&quot;java.util.Deque&quot;);</span>
<span class="nc" id="L115">        } catch (Throwable e) {</span>
            // skip
<span class="fc" id="L117">        }</span>
    }

    public static boolean isXmlField(Class clazz) {
<span class="pc bpc" id="L121" title="1 of 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L123">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="nc" id="L124">            } catch (Throwable ex) {</span>
<span class="nc" id="L125">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L126">            }</span>
        }

<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L130">            return false;</span>
        }

<span class="fc" id="L133">        Annotation annotation = TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L135">            return false;</span>
        }

<span class="pc bpc" id="L138" title="1 of 4 branches missed.">        if (method_XmlAccessorType_value == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L140">                method_XmlAccessorType_value = class_XmlAccessorType.getMethod(&quot;value&quot;);</span>
<span class="nc" id="L141">            } catch (Throwable ex) {</span>
<span class="nc" id="L142">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L143">            }</span>
        }

<span class="pc bpc" id="L146" title="1 of 2 branches missed.">        if (method_XmlAccessorType_value == null) {</span>
<span class="nc" id="L147">            return false;</span>
        }

<span class="fc" id="L150">        Object value = null;</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        if (!classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L153">                value = method_XmlAccessorType_value.invoke(annotation);</span>
<span class="nc" id="L154">            } catch (Throwable ex) {</span>
<span class="nc" id="L155">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L156">            }</span>
        }
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L159">            return false;</span>
        }

<span class="pc bpc" id="L162" title="1 of 4 branches missed.">        if (class_XmlAccessType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L164">                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);</span>
<span class="fc" id="L165">                field_XmlAccessType_FIELD = class_XmlAccessType.getField(&quot;FIELD&quot;);</span>
<span class="fc" id="L166">                field_XmlAccessType_FIELD_VALUE = field_XmlAccessType_FIELD.get(null);</span>
<span class="nc" id="L167">            } catch (Throwable ex) {</span>
<span class="nc" id="L168">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L169">            }</span>
        }

<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        return value == field_XmlAccessType_FIELD_VALUE;</span>
    }

    public static Annotation getXmlAccessorType(Class clazz) {
<span class="nc bnc" id="L176" title="All 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>

            try {
<span class="nc" id="L179">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="nc" id="L180">            } catch (Throwable ex) {</span>
<span class="nc" id="L181">                classXmlAccessorType_error = true;</span>
<span class="nc" id="L182">            }</span>
        }

<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L186">            return null;</span>
        }

<span class="nc" id="L189">        return TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
    }

//
//    public static boolean isXmlAccessType(Class clazz) {
//        if (class_XmlAccessType == null &amp;&amp; !class_XmlAccessType_error) {
//
//            try{
//                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);
//            } catch(Throwable ex){
//                class_XmlAccessType_error = true;
//            }
//        }
//
//        if (class_XmlAccessType == null) {
//            return false;
//        }
//
//        return  class_XmlAccessType.isAssignableFrom(clazz);
//    }

<span class="fc" id="L210">    private static Function&lt;Class, Boolean&gt; isClobFunction = new Function&lt;Class, Boolean&gt;() {</span>
        public Boolean apply(Class clazz) {
<span class="fc" id="L212">            return Clob.class.isAssignableFrom(clazz);</span>
        }
    };

    public static boolean isClob(final Class clazz) {
<span class="fc" id="L217">        Boolean isClob = ModuleUtil.callWhenHasJavaSql(isClobFunction, clazz);</span>

<span class="pc bpc" id="L219" title="1 of 2 branches missed.">        return isClob != null ? isClob : false;</span>
    }

    public static String castToString(Object value) {
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L224">            return null;</span>
        }
<span class="fc" id="L226">        return value.toString();</span>
    }

    public static Byte castToByte(Object value) {
<span class="fc bfc" id="L230" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L231">            return null;</span>
        }

<span class="pc bpc" id="L234" title="1 of 2 branches missed.">        if (value instanceof BigDecimal) {</span>
<span class="nc" id="L235">            return byteValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L238" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L239">            return ((Number) value).byteValue();</span>
        }

<span class="fc bfc" id="L242" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L243">            String strVal = (String) value;</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L245" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L247">                return null;</span>
            }
<span class="fc" id="L249">            return Byte.parseByte(strVal);</span>
        }

<span class="fc bfc" id="L252" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L253" title="All 2 branches covered.">            return (Boolean) value ? (byte) 1 : (byte) 0;</span>
        }

<span class="fc" id="L256">        throw new JSONException(&quot;can not cast to byte, value : &quot; + value);</span>
    }

    public static Character castToChar(Object value) {
<span class="fc bfc" id="L260" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L261">            return null;</span>
        }
<span class="fc bfc" id="L263" title="All 2 branches covered.">        if (value instanceof Character) {</span>
<span class="fc" id="L264">            return (Character) value;</span>
        }
<span class="fc bfc" id="L266" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L267">            String strVal = (String) value;</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">            if (strVal.length() == 0) {</span>
<span class="fc" id="L269">                return null;</span>
            }
<span class="fc bfc" id="L271" title="All 2 branches covered.">            if (strVal.length() != 1) {</span>
<span class="fc" id="L272">                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
            }
<span class="fc" id="L274">            return strVal.charAt(0);</span>
        }
<span class="fc" id="L276">        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
    }

    public static Short castToShort(Object value) {
<span class="fc bfc" id="L280" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L281">            return null;</span>
        }

<span class="pc bpc" id="L284" title="1 of 2 branches missed.">        if (value instanceof BigDecimal) {</span>
<span class="nc" id="L285">            return shortValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L288" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L289">            return ((Number) value).shortValue();</span>
        }

<span class="fc bfc" id="L292" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L293">            String strVal = (String) value;</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L295" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L297">                return null;</span>
            }
<span class="fc" id="L299">            return Short.parseShort(strVal);</span>
        }

<span class="fc bfc" id="L302" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">            return ((Boolean) value).booleanValue() ? (short) 1 : (short) 0;</span>
        }

<span class="fc" id="L306">        throw new JSONException(&quot;can not cast to short, value : &quot; + value);</span>
    }

    public static BigDecimal castToBigDecimal(Object value) {
<span class="fc bfc" id="L310" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L311">            return null;</span>
        }

<span class="fc bfc" id="L314" title="All 2 branches covered.">        if (value instanceof Float) {</span>
<span class="pc bpc" id="L315" title="1 of 4 branches missed.">            if (Float.isNaN((Float) value) || Float.isInfinite((Float) value)) {</span>
<span class="fc" id="L316">                return null;</span>
            }
<span class="fc bfc" id="L318" title="All 2 branches covered.">        } else if (value instanceof Double) {</span>
<span class="pc bpc" id="L319" title="1 of 4 branches missed.">            if (Double.isNaN((Double) value) || Double.isInfinite((Double) value)) {</span>
<span class="fc" id="L320">                return null;</span>
            }
<span class="fc bfc" id="L322" title="All 2 branches covered.">        } else if (value instanceof BigDecimal) {</span>
<span class="fc" id="L323">            return (BigDecimal) value;</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        } else if (value instanceof BigInteger) {</span>
<span class="fc" id="L325">            return new BigDecimal((BigInteger) value);</span>
<span class="fc bfc" id="L326" title="All 4 branches covered.">        } else if (value instanceof Map &amp;&amp; ((Map) value).size() == 0) {</span>
<span class="fc" id="L327">            return null;</span>
        }

<span class="fc" id="L330">        String strVal = value.toString();</span>

<span class="fc bfc" id="L332" title="All 2 branches covered.">        if (strVal.length() == 0</span>
<span class="fc bfc" id="L333" title="All 2 branches covered.">                || strVal.equalsIgnoreCase(&quot;null&quot;)) {</span>
<span class="fc" id="L334">            return null;</span>
        }

<span class="pc bpc" id="L337" title="1 of 2 branches missed.">        if (strVal.length() &gt; 65535) {</span>
<span class="nc" id="L338">            throw new JSONException(&quot;decimal overflow&quot;);</span>
        }
<span class="fc" id="L340">        return new BigDecimal(strVal);</span>
    }

    public static BigInteger castToBigInteger(Object value) {
<span class="fc bfc" id="L344" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L345">            return null;</span>
        }

<span class="fc bfc" id="L348" title="All 2 branches covered.">        if (value instanceof Float) {</span>
<span class="fc" id="L349">            Float floatValue = (Float) value;</span>
<span class="fc bfc" id="L350" title="All 4 branches covered.">            if (Float.isNaN(floatValue) || Float.isInfinite(floatValue)) {</span>
<span class="fc" id="L351">                return null;</span>
            }
<span class="fc" id="L353">            return BigInteger.valueOf(floatValue.longValue());</span>
<span class="fc bfc" id="L354" title="All 2 branches covered.">        } else if (value instanceof Double) {</span>
<span class="fc" id="L355">            Double doubleValue = (Double) value;</span>
<span class="fc bfc" id="L356" title="All 4 branches covered.">            if (Double.isNaN(doubleValue) || Double.isInfinite(doubleValue)) {</span>
<span class="fc" id="L357">                return null;</span>
            }
<span class="fc" id="L359">            return BigInteger.valueOf(doubleValue.longValue());</span>
<span class="fc bfc" id="L360" title="All 2 branches covered.">        } else if (value instanceof BigInteger) {</span>
<span class="fc" id="L361">            return (BigInteger) value;</span>
<span class="fc bfc" id="L362" title="All 2 branches covered.">        } else if (value instanceof BigDecimal) {</span>
<span class="fc" id="L363">            BigDecimal decimal = (BigDecimal) value;</span>
<span class="fc" id="L364">            int scale = decimal.scale();</span>
<span class="pc bpc" id="L365" title="1 of 4 branches missed.">            if (scale &gt; -1000 &amp;&amp; scale &lt; 1000) {</span>
<span class="fc" id="L366">                return ((BigDecimal) value).toBigInteger();</span>
            }
        }

<span class="fc" id="L370">        String strVal = value.toString();</span>

<span class="fc bfc" id="L372" title="All 2 branches covered.">        if (strVal.length() == 0</span>
<span class="fc bfc" id="L373" title="All 2 branches covered.">                || strVal.equalsIgnoreCase(&quot;null&quot;)) {</span>
<span class="fc" id="L374">            return null;</span>
        }

<span class="pc bpc" id="L377" title="1 of 2 branches missed.">        if (strVal.length() &gt; 65535) {</span>
<span class="nc" id="L378">            throw new JSONException(&quot;decimal overflow&quot;);</span>
        }
<span class="fc" id="L380">        return new BigInteger(strVal);</span>
    }

    public static Float castToFloat(Object value) {
<span class="fc bfc" id="L384" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L385">            return null;</span>
        }
<span class="fc bfc" id="L387" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L388">            return ((Number) value).floatValue();</span>
        }
<span class="fc bfc" id="L390" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L391">            String strVal = value.toString();</span>
<span class="fc bfc" id="L392" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L393" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L394" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L395">                return null;</span>
            }
<span class="fc bfc" id="L397" title="All 2 branches covered.">            if (strVal.indexOf(',') != -1) {</span>
<span class="fc" id="L398">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L400">            return Float.parseFloat(strVal);</span>
        }

<span class="fc bfc" id="L403" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">            return (Boolean) value ? 1F : 0F;</span>
        }

<span class="fc" id="L407">        throw new JSONException(&quot;can not cast to float, value : &quot; + value);</span>
    }

    public static Double castToDouble(Object value) {
<span class="fc bfc" id="L411" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L412">            return null;</span>
        }
<span class="fc bfc" id="L414" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L415">            return ((Number) value).doubleValue();</span>
        }
<span class="fc bfc" id="L417" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L418">            String strVal = value.toString();</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L420" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L421" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L422">                return null;</span>
            }
<span class="fc bfc" id="L424" title="All 2 branches covered.">            if (strVal.indexOf(',') != -1) {</span>
<span class="fc" id="L425">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L427">            return Double.parseDouble(strVal);</span>
        }

<span class="fc bfc" id="L430" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L431" title="All 2 branches covered.">            return (Boolean) value ? 1D : 0D;</span>
        }

<span class="fc" id="L434">        throw new JSONException(&quot;can not cast to double, value : &quot; + value);</span>
    }

    public static Date castToDate(Object value) {
<span class="fc" id="L438">        return castToDate(value, null);</span>
    }

    public static Date castToDate(Object value, String format) {
<span class="fc bfc" id="L442" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L443">            return null;</span>
        }

<span class="fc bfc" id="L446" title="All 2 branches covered.">        if (value instanceof Date) { // 使用频率最高的，应优先处理</span>
<span class="fc" id="L447">            return (Date) value;</span>
        }

<span class="fc bfc" id="L450" title="All 2 branches covered.">        if (value instanceof Calendar) {</span>
<span class="fc" id="L451">            return ((Calendar) value).getTime();</span>
        }

<span class="fc" id="L454">        long longValue = -1;</span>

<span class="fc bfc" id="L456" title="All 2 branches covered.">        if (value instanceof BigDecimal) {</span>
<span class="fc" id="L457">            longValue = longValue((BigDecimal) value);</span>
<span class="fc" id="L458">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L461" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L462">            longValue = ((Number) value).longValue();</span>
<span class="fc bfc" id="L463" title="All 2 branches covered.">            if (&quot;unixtime&quot;.equals(format)) {</span>
<span class="fc" id="L464">                longValue *= 1000;</span>
            }
<span class="fc" id="L466">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L469" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L470">            String strVal = (String) value;</span>
<span class="fc" id="L471">            JSONScanner dateLexer = new JSONScanner(strVal);</span>
            try {
<span class="fc bfc" id="L473" title="All 2 branches covered.">                if (dateLexer.scanISO8601DateIfMatch(false)) {</span>
<span class="fc" id="L474">                    Calendar calendar = dateLexer.getCalendar();</span>
<span class="fc" id="L475">                    return calendar.getTime();</span>
                }
            } finally {
<span class="fc" id="L478">                dateLexer.close();</span>
            }

<span class="pc bpc" id="L481" title="1 of 4 branches missed.">            if (strVal.startsWith(&quot;/Date(&quot;) &amp;&amp; strVal.endsWith(&quot;)/&quot;)) {</span>
<span class="fc" id="L482">                strVal = strVal.substring(6, strVal.length() - 2);</span>
            }

<span class="pc bpc" id="L485" title="2 of 6 branches missed.">            if (strVal.indexOf('-') &gt; 0 || strVal.indexOf('+') &gt; 0 || format != null) {</span>
<span class="pc bpc" id="L486" title="1 of 2 branches missed.">                if (format == null) {</span>
<span class="fc" id="L487">                    final int len = strVal.length();</span>
<span class="fc bfc" id="L488" title="All 4 branches covered.">                    if (len == JSON.DEFFAULT_DATE_FORMAT.length()</span>
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">                            || (len == 22 &amp;&amp; JSON.DEFFAULT_DATE_FORMAT.equals(&quot;yyyyMMddHHmmssSSSZ&quot;))) {</span>
<span class="fc" id="L490">                        format = JSON.DEFFAULT_DATE_FORMAT;</span>
<span class="fc bfc" id="L491" title="All 2 branches covered.">                    } else if (len == 10) {</span>
<span class="fc" id="L492">                        format = &quot;yyyy-MM-dd&quot;;</span>
<span class="pc bpc" id="L493" title="1 of 2 branches missed.">                    } else if (len == &quot;yyyy-MM-dd HH:mm:ss&quot;.length()) {</span>
<span class="nc" id="L494">                        format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
<span class="pc bpc" id="L495" title="1 of 2 branches missed.">                    } else if (len == 29</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(26) == ':'</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(28) == '0') {</span>
<span class="nc" id="L498">                        format = &quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;;</span>
<span class="pc bpc" id="L499" title="2 of 4 branches missed.">                    } else if (len == 23 &amp;&amp; strVal.charAt(19) == ',') {</span>
<span class="fc" id="L500">                        format = &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;;</span>
                    } else {
<span class="nc" id="L502">                        format = &quot;yyyy-MM-dd HH:mm:ss.SSS&quot;;</span>
                    }
                }

<span class="fc" id="L506">                SimpleDateFormat dateFormat = new SimpleDateFormat(format, JSON.defaultLocale);</span>
<span class="fc" id="L507">                dateFormat.setTimeZone(JSON.defaultTimeZone);</span>
                try {
<span class="fc" id="L509">                    return dateFormat.parse(strVal);</span>
<span class="fc" id="L510">                } catch (ParseException e) {</span>
<span class="fc" id="L511">                    throw new JSONException(&quot;can not cast to Date, value : &quot; + strVal);</span>
                }
            }
<span class="fc bfc" id="L514" title="All 2 branches covered.">            if (strVal.length() == 0) {</span>
<span class="fc" id="L515">                return null;</span>
            }
<span class="fc" id="L517">            longValue = Long.parseLong(strVal);</span>
        }

<span class="fc bfc" id="L520" title="All 2 branches covered.">        if (longValue == -1) {</span>
<span class="fc" id="L521">            Class&lt;?&gt; clazz = value.getClass();</span>
<span class="fc bfc" id="L522" title="All 2 branches covered.">            if (&quot;oracle.sql.TIMESTAMP&quot;.equals(clazz.getName())) {</span>
<span class="pc bpc" id="L523" title="2 of 4 branches missed.">                if (oracleTimestampMethod == null &amp;&amp; !oracleTimestampMethodInited) {</span>
                    try {
<span class="fc" id="L525">                        oracleTimestampMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L526">                    } catch (NoSuchMethodException e) {</span>
                        // skip
                    } finally {
<span class="fc" id="L529">                        oracleTimestampMethodInited = true;</span>
                    }
                }
                Object result;
                try {
<span class="fc" id="L534">                    result = oracleTimestampMethod.invoke(value);</span>
<span class="nc" id="L535">                } catch (Exception e) {</span>
<span class="nc" id="L536">                    throw new JSONException(&quot;can not cast oracle.sql.TIMESTAMP to Date&quot;, e);</span>
<span class="fc" id="L537">                }</span>
<span class="fc" id="L538">                return (Date) result;</span>
            }
<span class="fc bfc" id="L540" title="All 2 branches covered.">            if (&quot;oracle.sql.DATE&quot;.equals(clazz.getName())) {</span>
<span class="pc bpc" id="L541" title="2 of 4 branches missed.">                if (oracleDateMethod == null &amp;&amp; !oracleDateMethodInited) {</span>
                    try {
<span class="fc" id="L543">                        oracleDateMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L544">                    } catch (NoSuchMethodException e) {</span>
                        // skip
                    } finally {
<span class="fc" id="L547">                        oracleDateMethodInited = true;</span>
                    }
                }
                Object result;
                try {
<span class="fc" id="L552">                    result = oracleDateMethod.invoke(value);</span>
<span class="nc" id="L553">                } catch (Exception e) {</span>
<span class="nc" id="L554">                    throw new JSONException(&quot;can not cast oracle.sql.DATE to Date&quot;, e);</span>
<span class="fc" id="L555">                }</span>
<span class="fc" id="L556">                return (Date) result;</span>
            }

<span class="fc" id="L559">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value);</span>
        }

<span class="fc" id="L562">        return new Date(longValue);</span>
    }

<span class="fc" id="L565">    private static Function&lt;Object, Object&gt; castToSqlDateFunction = new Function&lt;Object, Object&gt;() {</span>
        public Object apply(Object value) {
<span class="fc bfc" id="L567" title="All 2 branches covered.">            if (value == null) {</span>
<span class="fc" id="L568">                return null;</span>
            }
<span class="fc bfc" id="L570" title="All 2 branches covered.">            if (value instanceof java.sql.Date) {</span>
<span class="fc" id="L571">                return (java.sql.Date) value;</span>
            }
<span class="fc bfc" id="L573" title="All 2 branches covered.">            if (value instanceof Date) {</span>
<span class="fc" id="L574">                return new java.sql.Date(((Date) value).getTime());</span>
            }
<span class="fc bfc" id="L576" title="All 2 branches covered.">            if (value instanceof Calendar) {</span>
<span class="fc" id="L577">                return new java.sql.Date(((Calendar) value).getTimeInMillis());</span>
            }

<span class="fc" id="L580">            long longValue = 0;</span>
<span class="fc bfc" id="L581" title="All 2 branches covered.">            if (value instanceof BigDecimal) {</span>
<span class="nc" id="L582">                longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L583" title="All 2 branches covered.">            } else if (value instanceof Number) {</span>
<span class="fc" id="L584">                longValue = ((Number) value).longValue();</span>
            }

<span class="fc bfc" id="L587" title="All 2 branches covered.">            if (value instanceof String) {</span>
<span class="fc" id="L588">                String strVal = (String) value;</span>
<span class="fc bfc" id="L589" title="All 2 branches covered.">                if (strVal.length() == 0 //</span>
<span class="pc bpc" id="L590" title="1 of 2 branches missed.">                        || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L591" title="1 of 2 branches missed.">                        || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L592">                    return null;</span>
                }
<span class="pc bpc" id="L594" title="1 of 2 branches missed.">                if (isNumber(strVal)) {</span>
<span class="fc" id="L595">                    longValue = Long.parseLong(strVal);</span>
                } else {
<span class="nc" id="L597">                    JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">                    if (scanner.scanISO8601DateIfMatch(false)) {</span>
<span class="nc" id="L599">                        longValue = scanner.getCalendar().getTime().getTime();</span>
                    } else {
<span class="nc" id="L601">                        throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                    }
                }
            }
<span class="fc bfc" id="L605" title="All 2 branches covered.">            if (longValue &lt;= 0) {</span>
<span class="fc" id="L606">                throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
            }
<span class="fc" id="L608">            return new java.sql.Date(longValue);</span>
        }
    };

    public static Object castToSqlDate(final Object value) {
<span class="fc" id="L613">        return ModuleUtil.callWhenHasJavaSql(castToSqlDateFunction, value);</span>
    }

    public static long longExtractValue(Number number) {
<span class="fc bfc" id="L617" title="All 2 branches covered.">        if (number instanceof BigDecimal) {</span>
<span class="fc" id="L618">            return ((BigDecimal) number).longValueExact();</span>
        }

<span class="fc" id="L621">        return number.longValue();</span>
    }

<span class="fc" id="L624">    private static Function&lt;Object, Object&gt; castToSqlTimeFunction = new Function&lt;Object, Object&gt;() {</span>
        public Object apply(Object value) {
<span class="pc bpc" id="L626" title="1 of 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L627">                return null;</span>
            }
<span class="pc bpc" id="L629" title="1 of 2 branches missed.">            if (value instanceof java.sql.Time) {</span>
<span class="nc" id="L630">                return (java.sql.Time) value;</span>
            }
<span class="pc bpc" id="L632" title="1 of 2 branches missed.">            if (value instanceof java.util.Date) {</span>
<span class="nc" id="L633">                return new java.sql.Time(((java.util.Date) value).getTime());</span>
            }
<span class="pc bpc" id="L635" title="1 of 2 branches missed.">            if (value instanceof Calendar) {</span>
<span class="nc" id="L636">                return new java.sql.Time(((Calendar) value).getTimeInMillis());</span>
            }

<span class="fc" id="L639">            long longValue = 0;</span>
<span class="fc bfc" id="L640" title="All 2 branches covered.">            if (value instanceof BigDecimal) {</span>
<span class="nc" id="L641">                longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L642" title="All 2 branches covered.">            } else if (value instanceof Number) {</span>
<span class="fc" id="L643">                longValue = ((Number) value).longValue();</span>
            }

<span class="fc bfc" id="L646" title="All 2 branches covered.">            if (value instanceof String) {</span>
<span class="fc" id="L647">                String strVal = (String) value;</span>
<span class="pc bpc" id="L648" title="1 of 2 branches missed.">                if (strVal.length() == 0 //</span>
<span class="pc bpc" id="L649" title="1 of 2 branches missed.">                        || &quot;null&quot;.equalsIgnoreCase(strVal)) {</span>
<span class="nc" id="L650">                    return null;</span>
                }

<span class="pc bpc" id="L653" title="1 of 2 branches missed.">                if (isNumber(strVal)) {</span>
<span class="nc" id="L654">                    longValue = Long.parseLong(strVal);</span>
                } else {
<span class="pc bpc" id="L656" title="3 of 6 branches missed.">                    if (strVal.length() == 8 &amp;&amp; strVal.charAt(2) == ':' &amp;&amp; strVal.charAt(5) == ':') {</span>
<span class="fc" id="L657">                        return java.sql.Time.valueOf(strVal);</span>
                    }

<span class="nc" id="L660">                    JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">                    if (scanner.scanISO8601DateIfMatch(false)) {</span>
<span class="nc" id="L662">                        longValue = scanner.getCalendar().getTime().getTime();</span>
                    } else {
<span class="nc" id="L664">                        throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                    }

                }
            }
<span class="pc bpc" id="L669" title="1 of 2 branches missed.">            if (longValue &lt;= 0) {</span>
<span class="nc" id="L670">                throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
            }
<span class="fc" id="L672">            return new java.sql.Time(longValue);</span>
        }
    };

    public static Object castToSqlTime(final Object value) {
<span class="fc" id="L677">        return ModuleUtil.callWhenHasJavaSql(castToSqlTimeFunction, value);</span>
    }

<span class="fc" id="L680">    public static Function&lt;Object, Object&gt; castToTimestampFunction = new Function&lt;Object, Object&gt;() {</span>
        public Object apply(Object value) {
<span class="fc bfc" id="L682" title="All 2 branches covered.">            if (value == null) {</span>
<span class="fc" id="L683">                return null;</span>
            }
<span class="fc bfc" id="L685" title="All 2 branches covered.">            if (value instanceof Calendar) {</span>
<span class="fc" id="L686">                return new java.sql.Timestamp(((Calendar) value).getTimeInMillis());</span>
            }
<span class="fc bfc" id="L688" title="All 2 branches covered.">            if (value instanceof java.sql.Timestamp) {</span>
<span class="fc" id="L689">                return (java.sql.Timestamp) value;</span>
            }
<span class="fc bfc" id="L691" title="All 2 branches covered.">            if (value instanceof java.util.Date) {</span>
<span class="fc" id="L692">                return new java.sql.Timestamp(((java.util.Date) value).getTime());</span>
            }
<span class="fc" id="L694">            long longValue = 0;</span>
<span class="fc bfc" id="L695" title="All 2 branches covered.">            if (value instanceof BigDecimal) {</span>
<span class="fc" id="L696">                longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L697" title="All 2 branches covered.">            } else if (value instanceof Number) {</span>
<span class="fc" id="L698">                longValue = ((Number) value).longValue();</span>
            }
<span class="fc bfc" id="L700" title="All 2 branches covered.">            if (value instanceof String) {</span>
<span class="fc" id="L701">                String strVal = (String) value;</span>
<span class="fc bfc" id="L702" title="All 2 branches covered.">                if (strVal.length() == 0 //</span>
<span class="pc bpc" id="L703" title="1 of 2 branches missed.">                        || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L704" title="1 of 2 branches missed.">                        || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L705">                    return null;</span>
                }
<span class="pc bpc" id="L707" title="1 of 2 branches missed.">                if (strVal.endsWith(&quot;.000000000&quot;)) {</span>
<span class="nc" id="L708">                    strVal = strVal.substring(0, strVal.length() - 10);</span>
<span class="pc bpc" id="L709" title="1 of 2 branches missed.">                } else if (strVal.endsWith(&quot;.000000&quot;)) {</span>
<span class="nc" id="L710">                    strVal = strVal.substring(0, strVal.length() - 7);</span>
                }

<span class="fc bfc" id="L713" title="All 2 branches covered.">                if (strVal.length() == 29</span>
<span class="pc bpc" id="L714" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(4) == '-'</span>
<span class="pc bpc" id="L715" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(7) == '-'</span>
<span class="pc bpc" id="L716" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(10) == ' '</span>
<span class="pc bpc" id="L717" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(13) == ':'</span>
<span class="pc bpc" id="L718" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(16) == ':'</span>
<span class="pc bpc" id="L719" title="1 of 2 branches missed.">                        &amp;&amp; strVal.charAt(19) == '.') {</span>
<span class="fc" id="L720">                    int year = num(</span>
<span class="fc" id="L721">                            strVal.charAt(0),</span>
<span class="fc" id="L722">                            strVal.charAt(1),</span>
<span class="fc" id="L723">                            strVal.charAt(2),</span>
<span class="fc" id="L724">                            strVal.charAt(3));</span>
<span class="fc" id="L725">                    int month = num(</span>
<span class="fc" id="L726">                            strVal.charAt(5),</span>
<span class="fc" id="L727">                            strVal.charAt(6));</span>
<span class="fc" id="L728">                    int day = num(</span>
<span class="fc" id="L729">                            strVal.charAt(8),</span>
<span class="fc" id="L730">                            strVal.charAt(9));</span>
<span class="fc" id="L731">                    int hour = num(</span>
<span class="fc" id="L732">                            strVal.charAt(11),</span>
<span class="fc" id="L733">                            strVal.charAt(12));</span>
<span class="fc" id="L734">                    int minute = num(</span>
<span class="fc" id="L735">                            strVal.charAt(14),</span>
<span class="fc" id="L736">                            strVal.charAt(15));</span>
<span class="fc" id="L737">                    int second = num(</span>
<span class="fc" id="L738">                            strVal.charAt(17),</span>
<span class="fc" id="L739">                            strVal.charAt(18));</span>
<span class="fc" id="L740">                    int nanos = num(</span>
<span class="fc" id="L741">                            strVal.charAt(20),</span>
<span class="fc" id="L742">                            strVal.charAt(21),</span>
<span class="fc" id="L743">                            strVal.charAt(22),</span>
<span class="fc" id="L744">                            strVal.charAt(23),</span>
<span class="fc" id="L745">                            strVal.charAt(24),</span>
<span class="fc" id="L746">                            strVal.charAt(25),</span>
<span class="fc" id="L747">                            strVal.charAt(26),</span>
<span class="fc" id="L748">                            strVal.charAt(27),</span>
<span class="fc" id="L749">                            strVal.charAt(28));</span>
<span class="fc" id="L750">                    return new java.sql.Timestamp(year - 1900, month - 1, day, hour, minute, second, nanos);</span>
                }

<span class="fc bfc" id="L753" title="All 2 branches covered.">                if (isNumber(strVal)) {</span>
<span class="fc" id="L754">                    longValue = Long.parseLong(strVal);</span>
                } else {
<span class="fc" id="L756">                    JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="pc bpc" id="L757" title="1 of 2 branches missed.">                    if (scanner.scanISO8601DateIfMatch(false)) {</span>
<span class="fc" id="L758">                        longValue = scanner.getCalendar().getTime().getTime();</span>
                    } else {
<span class="nc" id="L760">                        throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                    }
                }
            }

<span class="fc" id="L765">            return new java.sql.Timestamp(longValue);</span>
        }
    };

    public static Object castToTimestamp(final Object value) {
<span class="fc" id="L770">        return ModuleUtil.callWhenHasJavaSql(castToTimestampFunction, value);</span>
    }

    static int num(char c0, char c1) {
<span class="pc bpc" id="L774" title="4 of 8 branches missed.">        if (c0 &gt;= '0'</span>
                &amp;&amp; c0 &lt;= '9'
                &amp;&amp; c1 &gt;= '0'
                &amp;&amp; c1 &lt;= '9'
        ) {
<span class="fc" id="L779">            return (c0 - '0') * 10</span>
                    + (c1 - '0');
        }

<span class="nc" id="L783">        return -1;</span>
    }

    static int num(char c0, char c1, char c2, char c3) {
<span class="pc bpc" id="L787" title="8 of 16 branches missed.">        if (c0 &gt;= '0'</span>
                &amp;&amp; c0 &lt;= '9'
                &amp;&amp; c1 &gt;= '0'
                &amp;&amp; c1 &lt;= '9'
                &amp;&amp; c2 &gt;= '0'
                &amp;&amp; c2 &lt;= '9'
                &amp;&amp; c3 &gt;= '0'
                &amp;&amp; c3 &lt;= '9'
        ) {
<span class="fc" id="L796">            return (c0 - '0') * 1000</span>
                    + (c1 - '0') * 100
                    + (c2 - '0') * 10
                    + (c3 - '0');
        }

<span class="nc" id="L802">        return -1;</span>
    }

    static int num(char c0, char c1, char c2, char c3, char c4, char c5, char c6, char c7, char c8) {
<span class="pc bpc" id="L806" title="18 of 36 branches missed.">        if (c0 &gt;= '0'</span>
                &amp;&amp; c0 &lt;= '9'
                &amp;&amp; c1 &gt;= '0'
                &amp;&amp; c1 &lt;= '9'
                &amp;&amp; c2 &gt;= '0'
                &amp;&amp; c2 &lt;= '9'
                &amp;&amp; c3 &gt;= '0'
                &amp;&amp; c3 &lt;= '9'
                &amp;&amp; c4 &gt;= '0'
                &amp;&amp; c4 &lt;= '9'
                &amp;&amp; c5 &gt;= '0'
                &amp;&amp; c5 &lt;= '9'
                &amp;&amp; c6 &gt;= '0'
                &amp;&amp; c6 &lt;= '9'
                &amp;&amp; c7 &gt;= '0'
                &amp;&amp; c7 &lt;= '9'
                &amp;&amp; c8 &gt;= '0'
                &amp;&amp; c8 &lt;= '9'
        ) {
<span class="fc" id="L825">            return (c0 - '0') * 100000000</span>
                    + (c1 - '0') * 10000000
                    + (c2 - '0') * 1000000
                    + (c3 - '0') * 100000
                    + (c4 - '0') * 10000
                    + (c5 - '0') * 1000
                    + (c6 - '0') * 100
                    + (c7 - '0') * 10
                    + (c8 - '0');
        }

<span class="nc" id="L836">        return -1;</span>
    }

    public static boolean isNumber(String str) {
<span class="fc bfc" id="L840" title="All 2 branches covered.">        for (int i = 0; i &lt; str.length(); ++i) {</span>
<span class="fc" id="L841">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L842" title="1 of 4 branches missed.">            if (ch == '+' || ch == '-') {</span>
<span class="fc bfc" id="L843" title="All 2 branches covered.">                if (i != 0) {</span>
<span class="fc" id="L844">                    return false;</span>
                }
<span class="fc bfc" id="L846" title="All 4 branches covered.">            } else if (ch &lt; '0' || ch &gt; '9') {</span>
<span class="fc" id="L847">                return false;</span>
            }
        }
<span class="fc" id="L850">        return true;</span>
    }

    public static Long castToLong(Object value) {
<span class="fc bfc" id="L854" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L855">            return null;</span>
        }

<span class="pc bpc" id="L858" title="1 of 2 branches missed.">        if (value instanceof BigDecimal) {</span>
<span class="nc" id="L859">            return longValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L862" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L863">            return ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L866" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L867">            String strVal = (String) value;</span>
<span class="fc bfc" id="L868" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L869" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L870" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L871">                return null;</span>
            }
<span class="fc bfc" id="L873" title="All 2 branches covered.">            if (strVal.indexOf(',') != -1) {</span>
<span class="fc" id="L874">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            try {
<span class="fc" id="L877">                return Long.parseLong(strVal);</span>
<span class="fc" id="L878">            } catch (NumberFormatException ex) {</span>
                //
            }
<span class="fc" id="L881">            JSONScanner dateParser = new JSONScanner(strVal);</span>
<span class="fc" id="L882">            Calendar calendar = null;</span>
<span class="fc bfc" id="L883" title="All 2 branches covered.">            if (dateParser.scanISO8601DateIfMatch(false)) {</span>
<span class="fc" id="L884">                calendar = dateParser.getCalendar();</span>
            }
<span class="fc" id="L886">            dateParser.close();</span>
<span class="fc bfc" id="L887" title="All 2 branches covered.">            if (calendar != null) {</span>
<span class="fc" id="L888">                return calendar.getTimeInMillis();</span>
            }
        }

<span class="fc bfc" id="L892" title="All 2 branches covered.">        if (value instanceof Map) {</span>
<span class="fc" id="L893">            Map map = (Map) value;</span>
<span class="fc bfc" id="L894" title="All 2 branches covered.">            if (map.size() == 2</span>
<span class="pc bpc" id="L895" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L896" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)) {</span>
<span class="fc" id="L897">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L898">                iter.next();</span>
<span class="fc" id="L899">                Object value2 = iter.next();</span>
<span class="fc" id="L900">                return castToLong(value2);</span>
            }
        }

<span class="fc bfc" id="L904" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L905" title="All 2 branches covered.">            return (Boolean) value ? 1L : 0L;</span>
        }

<span class="fc" id="L908">        throw new JSONException(&quot;can not cast to long, value : &quot; + value);</span>
    }

    public static byte byteValue(BigDecimal decimal) {
<span class="pc bpc" id="L912" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L913">            return 0;</span>
        }

<span class="fc" id="L916">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L917" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L918">            return decimal.byteValue();</span>
        }

<span class="nc" id="L921">        return decimal.byteValueExact();</span>
    }

    public static short shortValue(BigDecimal decimal) {
<span class="pc bpc" id="L925" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L926">            return 0;</span>
        }

<span class="fc" id="L929">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L930" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L931">            return decimal.shortValue();</span>
        }

<span class="nc" id="L934">        return decimal.shortValueExact();</span>
    }

    public static int intValue(BigDecimal decimal) {
<span class="pc bpc" id="L938" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L939">            return 0;</span>
        }

<span class="fc" id="L942">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L943" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L944">            return decimal.intValue();</span>
        }

<span class="nc" id="L947">        return decimal.intValueExact();</span>
    }

    public static long longValue(BigDecimal decimal) {
<span class="pc bpc" id="L951" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L952">            return 0;</span>
        }

<span class="fc" id="L955">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L956" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L957">            return decimal.longValue();</span>
        }

<span class="nc" id="L960">        return decimal.longValueExact();</span>
    }

    public static Integer castToInt(Object value) {
<span class="fc bfc" id="L964" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L965">            return null;</span>
        }

<span class="fc bfc" id="L968" title="All 2 branches covered.">        if (value instanceof Integer) {</span>
<span class="fc" id="L969">            return (Integer) value;</span>
        }

<span class="fc bfc" id="L972" title="All 2 branches covered.">        if (value instanceof BigDecimal) {</span>
<span class="fc" id="L973">            return intValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L976" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L977">            return ((Number) value).intValue();</span>
        }

<span class="fc bfc" id="L980" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L981">            String strVal = (String) value;</span>
<span class="fc bfc" id="L982" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L983" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L984" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L985">                return null;</span>
            }
<span class="fc bfc" id="L987" title="All 2 branches covered.">            if (strVal.indexOf(',') != -1) {</span>
<span class="fc" id="L988">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }

<span class="fc" id="L991">            Matcher matcher = NUMBER_WITH_TRAILING_ZEROS_PATTERN.matcher(strVal);</span>
<span class="fc bfc" id="L992" title="All 2 branches covered.">            if (matcher.find()) {</span>
<span class="fc" id="L993">                strVal = matcher.replaceAll(&quot;&quot;);</span>
            }
<span class="fc" id="L995">            return Integer.parseInt(strVal);</span>
        }

<span class="fc bfc" id="L998" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc bfc" id="L999" title="All 2 branches covered.">            return (Boolean) value ? 1 : 0;</span>
        }
<span class="fc bfc" id="L1001" title="All 2 branches covered.">        if (value instanceof Map) {</span>
<span class="fc" id="L1002">            Map map = (Map) value;</span>
<span class="fc bfc" id="L1003" title="All 2 branches covered.">            if (map.size() == 2</span>
<span class="pc bpc" id="L1004" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L1005" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)) {</span>
<span class="fc" id="L1006">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L1007">                iter.next();</span>
<span class="fc" id="L1008">                Object value2 = iter.next();</span>
<span class="fc" id="L1009">                return castToInt(value2);</span>
            }
        }
<span class="fc" id="L1012">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static byte[] castToBytes(Object value) {
<span class="fc bfc" id="L1016" title="All 2 branches covered.">        if (value instanceof byte[]) {</span>
<span class="fc" id="L1017">            return (byte[]) value;</span>
        }
<span class="fc bfc" id="L1019" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L1020">            return IOUtils.decodeBase64((String) value);</span>
        }
<span class="fc" id="L1022">        throw new JSONException(&quot;can not cast to byte[], value : &quot; + value);</span>
    }

    public static Boolean castToBoolean(Object value) {
<span class="fc bfc" id="L1026" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L1027">            return null;</span>
        }
<span class="fc bfc" id="L1029" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc" id="L1030">            return (Boolean) value;</span>
        }

<span class="fc bfc" id="L1033" title="All 2 branches covered.">        if (value instanceof BigDecimal) {</span>
<span class="nc bnc" id="L1034" title="All 2 branches missed.">            return intValue((BigDecimal) value) == 1;</span>
        }

<span class="fc bfc" id="L1037" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc bfc" id="L1038" title="All 2 branches covered.">            return ((Number) value).intValue() == 1;</span>
        }

<span class="fc bfc" id="L1041" title="All 2 branches covered.">        if (value instanceof String) {</span>
<span class="fc" id="L1042">            String strVal = (String) value;</span>
<span class="fc bfc" id="L1043" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L1044" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L1045" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L1046">                return null;</span>
            }
<span class="fc bfc" id="L1048" title="All 2 branches covered.">            if (&quot;true&quot;.equalsIgnoreCase(strVal) //</span>
<span class="pc bpc" id="L1049" title="1 of 2 branches missed.">                    || &quot;1&quot;.equals(strVal)) {</span>
<span class="fc" id="L1050">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L1052" title="All 2 branches covered.">            if (&quot;false&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L1053" title="All 2 branches covered.">                    || &quot;0&quot;.equals(strVal)) {</span>
<span class="fc" id="L1054">                return Boolean.FALSE;</span>
            }
<span class="fc bfc" id="L1056" title="All 2 branches covered.">            if (&quot;Y&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L1057" title="All 2 branches covered.">                    || &quot;T&quot;.equals(strVal)) {</span>
<span class="fc" id="L1058">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L1060" title="All 2 branches covered.">            if (&quot;F&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L1061" title="All 2 branches covered.">                    || &quot;N&quot;.equals(strVal)) {</span>
<span class="fc" id="L1062">                return Boolean.FALSE;</span>
            }
        }
<span class="fc" id="L1065">        throw new JSONException(&quot;can not cast to boolean, value : &quot; + value);</span>
    }

    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz) {
<span class="fc" id="L1069">        return cast(obj, clazz, ParserConfig.getGlobalInstance());</span>
    }

<span class="fc" id="L1072">    private static BiFunction&lt;Object, Class, Object&gt; castFunction = new BiFunction&lt;Object, Class, Object&gt;() {</span>
        public Object apply(Object obj, Class clazz) {
<span class="fc bfc" id="L1074" title="All 2 branches covered.">            if (clazz == java.sql.Date.class) {</span>
<span class="fc" id="L1075">                return castToSqlDate(obj);</span>
            }

<span class="fc bfc" id="L1078" title="All 2 branches covered.">            if (clazz == java.sql.Time.class) {</span>
<span class="fc" id="L1079">                return castToSqlTime(obj);</span>
            }

<span class="fc bfc" id="L1082" title="All 2 branches covered.">            if (clazz == java.sql.Timestamp.class) {</span>
<span class="fc" id="L1083">                return castToTimestamp(obj);</span>
            }
<span class="fc" id="L1085">            return null;</span>
        }
    };

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T cast(final Object obj, final Class&lt;T&gt; clazz, ParserConfig config) {
<span class="fc bfc" id="L1091" title="All 2 branches covered.">        if (obj == null) {</span>
<span class="fc bfc" id="L1092" title="All 2 branches covered.">            if (clazz == int.class) {</span>
<span class="fc" id="L1093">                return (T) Integer.valueOf(0);</span>
<span class="fc bfc" id="L1094" title="All 2 branches covered.">            } else if (clazz == long.class) {</span>
<span class="fc" id="L1095">                return (T) Long.valueOf(0);</span>
<span class="fc bfc" id="L1096" title="All 2 branches covered.">            } else if (clazz == short.class) {</span>
<span class="fc" id="L1097">                return (T) Short.valueOf((short) 0);</span>
<span class="fc bfc" id="L1098" title="All 2 branches covered.">            } else if (clazz == byte.class) {</span>
<span class="fc" id="L1099">                return (T) Byte.valueOf((byte) 0);</span>
<span class="fc bfc" id="L1100" title="All 2 branches covered.">            } else if (clazz == float.class) {</span>
<span class="fc" id="L1101">                return (T) Float.valueOf(0);</span>
<span class="fc bfc" id="L1102" title="All 2 branches covered.">            } else if (clazz == double.class) {</span>
<span class="fc" id="L1103">                return (T) Double.valueOf(0);</span>
<span class="fc bfc" id="L1104" title="All 2 branches covered.">            } else if (clazz == boolean.class) {</span>
<span class="fc" id="L1105">                return (T) Boolean.FALSE;</span>
            }
<span class="fc" id="L1107">            return null;</span>
        }

<span class="fc bfc" id="L1110" title="All 2 branches covered.">        if (clazz == null) {</span>
<span class="fc" id="L1111">            throw new IllegalArgumentException(&quot;clazz is null&quot;);</span>
        }

<span class="fc bfc" id="L1114" title="All 2 branches covered.">        if (clazz == obj.getClass()) {</span>
<span class="fc" id="L1115">            return (T) obj;</span>
        }

<span class="fc bfc" id="L1118" title="All 2 branches covered.">        if (obj instanceof Map) {</span>
<span class="fc bfc" id="L1119" title="All 2 branches covered.">            if (clazz == Map.class) {</span>
<span class="fc" id="L1120">                return (T) obj;</span>
            }

<span class="fc" id="L1123">            Map map = (Map) obj;</span>
<span class="fc bfc" id="L1124" title="All 4 branches covered.">            if (clazz == Object.class &amp;&amp; !map.containsKey(JSON.DEFAULT_TYPE_KEY)) {</span>
<span class="fc" id="L1125">                return (T) obj;</span>
            }
<span class="fc" id="L1127">            return castToJavaBean((Map&lt;String, Object&gt;) obj, clazz, config);</span>
        }

<span class="fc bfc" id="L1130" title="All 2 branches covered.">        if (clazz.isArray()) {</span>
<span class="fc bfc" id="L1131" title="All 2 branches covered.">            if (obj instanceof Collection) {</span>
<span class="fc" id="L1132">                Collection collection = (Collection) obj;</span>
<span class="fc" id="L1133">                int index = 0;</span>
<span class="fc" id="L1134">                Object array = Array.newInstance(clazz.getComponentType(), collection.size());</span>
<span class="fc bfc" id="L1135" title="All 2 branches covered.">                for (Object item : collection) {</span>
<span class="fc" id="L1136">                    Object value = cast(item, clazz.getComponentType(), config);</span>
<span class="fc" id="L1137">                    Array.set(array, index, value);</span>
<span class="fc" id="L1138">                    index++;</span>
<span class="fc" id="L1139">                }</span>
<span class="fc" id="L1140">                return (T) array;</span>
            }
<span class="fc bfc" id="L1142" title="All 2 branches covered.">            if (clazz == byte[].class) {</span>
<span class="fc" id="L1143">                return (T) castToBytes(obj);</span>
            }
        }

<span class="fc bfc" id="L1147" title="All 2 branches covered.">        if (clazz.isAssignableFrom(obj.getClass())) {</span>
<span class="fc" id="L1148">            return (T) obj;</span>
        }

<span class="fc bfc" id="L1151" title="All 4 branches covered.">        if (clazz == boolean.class || clazz == Boolean.class) {</span>
<span class="fc" id="L1152">            return (T) castToBoolean(obj);</span>
        }

<span class="fc bfc" id="L1155" title="All 4 branches covered.">        if (clazz == byte.class || clazz == Byte.class) {</span>
<span class="fc" id="L1156">            return (T) castToByte(obj);</span>
        }

<span class="pc bpc" id="L1159" title="1 of 4 branches missed.">        if (clazz == char.class || clazz == Character.class) {</span>
<span class="fc" id="L1160">            return (T) castToChar(obj);</span>
        }

<span class="fc bfc" id="L1163" title="All 4 branches covered.">        if (clazz == short.class || clazz == Short.class) {</span>
<span class="fc" id="L1164">            return (T) castToShort(obj);</span>
        }

<span class="fc bfc" id="L1167" title="All 4 branches covered.">        if (clazz == int.class || clazz == Integer.class) {</span>
<span class="fc" id="L1168">            return (T) castToInt(obj);</span>
        }

<span class="fc bfc" id="L1171" title="All 4 branches covered.">        if (clazz == long.class || clazz == Long.class) {</span>
<span class="fc" id="L1172">            return (T) castToLong(obj);</span>
        }

<span class="fc bfc" id="L1175" title="All 4 branches covered.">        if (clazz == float.class || clazz == Float.class) {</span>
<span class="fc" id="L1176">            return (T) castToFloat(obj);</span>
        }

<span class="fc bfc" id="L1179" title="All 4 branches covered.">        if (clazz == double.class || clazz == Double.class) {</span>
<span class="fc" id="L1180">            return (T) castToDouble(obj);</span>
        }

<span class="fc bfc" id="L1183" title="All 2 branches covered.">        if (clazz == String.class) {</span>
<span class="fc" id="L1184">            return (T) castToString(obj);</span>
        }

<span class="fc bfc" id="L1187" title="All 2 branches covered.">        if (clazz == BigDecimal.class) {</span>
<span class="fc" id="L1188">            return (T) castToBigDecimal(obj);</span>
        }

<span class="fc bfc" id="L1191" title="All 2 branches covered.">        if (clazz == BigInteger.class) {</span>
<span class="fc" id="L1192">            return (T) castToBigInteger(obj);</span>
        }

<span class="fc bfc" id="L1195" title="All 2 branches covered.">        if (clazz == Date.class) {</span>
<span class="fc" id="L1196">            return (T) castToDate(obj);</span>
        }

<span class="fc" id="L1199">        T retObj = (T) ModuleUtil.callWhenHasJavaSql(castFunction, obj, clazz);</span>

<span class="fc bfc" id="L1201" title="All 2 branches covered.">        if (retObj != null) {</span>
<span class="fc" id="L1202">            return retObj;</span>
        }

<span class="fc bfc" id="L1205" title="All 2 branches covered.">        if (clazz.isEnum()) {</span>
<span class="fc" id="L1206">            return castToEnum(obj, clazz, config);</span>
        }

<span class="fc bfc" id="L1209" title="All 2 branches covered.">        if (Calendar.class.isAssignableFrom(clazz)) {</span>
<span class="fc" id="L1210">            Date date = castToDate(obj);</span>
            Calendar calendar;
<span class="fc bfc" id="L1212" title="All 2 branches covered.">            if (clazz == Calendar.class) {</span>
<span class="fc" id="L1213">                calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
            } else {
                try {
<span class="fc" id="L1216">                    calendar = (Calendar) clazz.newInstance();</span>
<span class="fc" id="L1217">                } catch (Exception e) {</span>
<span class="fc" id="L1218">                    throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), e);</span>
<span class="fc" id="L1219">                }</span>
            }
<span class="fc" id="L1221">            calendar.setTime(date);</span>
<span class="fc" id="L1222">            return (T) calendar;</span>
        }

<span class="fc" id="L1225">        String className = clazz.getName();</span>
<span class="fc bfc" id="L1226" title="All 2 branches covered.">        if (className.equals(&quot;javax.xml.datatype.XMLGregorianCalendar&quot;)) {</span>
<span class="fc" id="L1227">            Date date = castToDate(obj);</span>
<span class="fc" id="L1228">            Calendar calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L1229">            calendar.setTime(date);</span>
<span class="fc" id="L1230">            return (T) CalendarCodec.instance.createXMLGregorianCalendar(calendar);</span>
        }

<span class="fc bfc" id="L1233" title="All 2 branches covered.">        if (obj instanceof String) {</span>
<span class="fc" id="L1234">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1235" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L1236" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1237" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L1238">                return null;</span>
            }

<span class="pc bpc" id="L1241" title="1 of 2 branches missed.">            if (clazz == java.util.Currency.class) {</span>
<span class="nc" id="L1242">                return (T) java.util.Currency.getInstance(strVal);</span>
            }

<span class="pc bpc" id="L1245" title="1 of 2 branches missed.">            if (clazz == java.util.Locale.class) {</span>
<span class="nc" id="L1246">                return (T) toLocale(strVal);</span>
            }

<span class="pc bpc" id="L1249" title="1 of 2 branches missed.">            if (className.startsWith(&quot;java.time.&quot;)) {</span>
<span class="nc" id="L1250">                String json = JSON.toJSONString(strVal);</span>
<span class="nc" id="L1251">                return JSON.parseObject(json, clazz);</span>
            }
        }

<span class="fc" id="L1255">        final ObjectDeserializer objectDeserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1256" title="All 2 branches covered.">        if (objectDeserializer != null) {</span>
<span class="fc" id="L1257">            String str = JSON.toJSONString(obj);</span>
<span class="nc" id="L1258">            return JSON.parseObject(str, clazz);</span>
        }
<span class="fc" id="L1260">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    public static Locale toLocale(String strVal) {
<span class="fc" id="L1264">        String[] items = strVal.split(&quot;_&quot;);</span>
<span class="fc bfc" id="L1265" title="All 2 branches covered.">        if (items.length == 1) {</span>
<span class="fc" id="L1266">            return new Locale(items[0]);</span>
        }
<span class="fc bfc" id="L1268" title="All 2 branches covered.">        if (items.length == 2) {</span>
<span class="fc" id="L1269">            return new Locale(items[0], items[1]);</span>
        }
<span class="fc" id="L1271">        return new Locale(items[0], items[1], items[2]);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T castToEnum(Object obj, Class&lt;T&gt; clazz, ParserConfig mapping) {
        try {
<span class="fc bfc" id="L1277" title="All 2 branches covered.">            if (obj instanceof String) {</span>
<span class="fc" id="L1278">                String name = (String) obj;</span>
<span class="fc bfc" id="L1279" title="All 2 branches covered.">                if (name.length() == 0) {</span>
<span class="fc" id="L1280">                    return null;</span>
                }

<span class="fc bfc" id="L1283" title="All 2 branches covered.">                if (mapping == null) {</span>
<span class="fc" id="L1284">                    mapping = ParserConfig.getGlobalInstance();</span>
                }

<span class="fc" id="L1287">                ObjectDeserializer deserializer = mapping.getDeserializer(clazz);</span>
<span class="pc bpc" id="L1288" title="1 of 2 branches missed.">                if (deserializer instanceof EnumDeserializer) {</span>
<span class="fc" id="L1289">                    EnumDeserializer enumDeserializer = (EnumDeserializer) deserializer;</span>
<span class="fc" id="L1290">                    return (T) enumDeserializer.getEnumByHashCode(TypeUtils.fnv1a_64(name));</span>
                }

<span class="nc" id="L1293">                return (T) Enum.valueOf((Class&lt;? extends Enum&gt;) clazz, name);</span>
            }

<span class="fc bfc" id="L1296" title="All 2 branches covered.">            if (obj instanceof BigDecimal) {</span>
<span class="nc" id="L1297">                int ordinal = intValue((BigDecimal) obj);</span>
<span class="nc" id="L1298">                Object[] values = clazz.getEnumConstants();</span>
<span class="nc bnc" id="L1299" title="All 2 branches missed.">                if (ordinal &lt; values.length) {</span>
<span class="nc" id="L1300">                    return (T) values[ordinal];</span>
                }
            }

<span class="fc bfc" id="L1304" title="All 2 branches covered.">            if (obj instanceof Number) {</span>
<span class="fc" id="L1305">                int ordinal = ((Number) obj).intValue();</span>
<span class="fc" id="L1306">                Object[] values = clazz.getEnumConstants();</span>
<span class="fc bfc" id="L1307" title="All 2 branches covered.">                if (ordinal &lt; values.length) {</span>
<span class="fc" id="L1308">                    return (T) values[ordinal];</span>
                }
            }
<span class="fc" id="L1311">        } catch (Exception ex) {</span>
<span class="fc" id="L1312">            throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), ex);</span>
<span class="fc" id="L1313">        }</span>
<span class="fc" id="L1314">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping) {
<span class="fc bfc" id="L1319" title="All 2 branches covered.">        if (obj == null) {</span>
<span class="fc" id="L1320">            return null;</span>
        }
<span class="fc bfc" id="L1322" title="All 2 branches covered.">        if (type instanceof Class) {</span>
<span class="fc" id="L1323">            return cast(obj, (Class&lt;T&gt;) type, mapping);</span>
        }
<span class="fc bfc" id="L1325" title="All 2 branches covered.">        if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L1326">            return (T) cast(obj, (ParameterizedType) type, mapping);</span>
        }
<span class="pc bpc" id="L1328" title="1 of 2 branches missed.">        if (obj instanceof String) {</span>
<span class="fc" id="L1329">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1330" title="All 2 branches covered.">            if (strVal.length() == 0 //</span>
<span class="fc bfc" id="L1331" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1332" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)) {</span>
<span class="fc" id="L1333">                return null;</span>
            }
        }
<span class="pc bpc" id="L1336" title="1 of 2 branches missed.">        if (type instanceof TypeVariable) {</span>
<span class="nc" id="L1337">            return (T) obj;</span>
        }
<span class="fc" id="L1339">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping) {
<span class="fc" id="L1344">        Type rawTye = type.getRawType();</span>

<span class="fc bfc" id="L1346" title="All 4 branches covered.">        if (rawTye == List.class || rawTye == ArrayList.class) {</span>
<span class="fc" id="L1347">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1348" title="All 2 branches covered.">            if (obj instanceof List) {</span>
<span class="fc" id="L1349">                List listObj = (List) obj;</span>
<span class="fc" id="L1350">                List arrayList = new ArrayList(listObj.size());</span>

<span class="fc bfc" id="L1352" title="All 2 branches covered.">                for (Object item : listObj) {</span>
                    Object itemValue;
<span class="pc bpc" id="L1354" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1355" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1356">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
                        } else {
<span class="fc" id="L1358">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
                    } else {
<span class="nc" id="L1361">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1364">                    arrayList.add(itemValue);</span>
<span class="fc" id="L1365">                }</span>
<span class="fc" id="L1366">                return (T) arrayList;</span>
            }
        }

<span class="pc bpc" id="L1370" title="3 of 12 branches missed.">        if (rawTye == Set.class || rawTye == HashSet.class //</span>
                || rawTye == TreeSet.class //
                || rawTye == Collection.class //
                || rawTye == List.class //
                || rawTye == ArrayList.class) {
<span class="fc" id="L1375">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1376" title="All 2 branches covered.">            if (obj instanceof Iterable) {</span>
                Collection collection;
<span class="pc bpc" id="L1378" title="2 of 4 branches missed.">                if (rawTye == Set.class || rawTye == HashSet.class) {</span>
<span class="nc" id="L1379">                    collection = new HashSet();</span>
<span class="pc bpc" id="L1380" title="1 of 2 branches missed.">                } else if (rawTye == TreeSet.class) {</span>
<span class="nc" id="L1381">                    collection = new TreeSet();</span>
                } else {
<span class="fc" id="L1383">                    collection = new ArrayList();</span>
                }
<span class="fc bfc" id="L1385" title="All 2 branches covered.">                for (Object item : (Iterable) obj) {</span>
                    Object itemValue;
<span class="pc bpc" id="L1387" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1388" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1389">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
                        } else {
<span class="fc" id="L1391">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
                    } else {
<span class="nc" id="L1394">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1397">                    collection.add(itemValue);</span>
<span class="fc" id="L1398">                }</span>
<span class="fc" id="L1399">                return (T) collection;</span>
            }
        }

<span class="fc bfc" id="L1403" title="All 4 branches covered.">        if (rawTye == Map.class || rawTye == HashMap.class) {</span>
<span class="fc" id="L1404">            Type keyType = type.getActualTypeArguments()[0];</span>
<span class="fc" id="L1405">            Type valueType = type.getActualTypeArguments()[1];</span>
<span class="fc bfc" id="L1406" title="All 2 branches covered.">            if (obj instanceof Map) {</span>
<span class="fc" id="L1407">                Map map = new HashMap();</span>
<span class="fc bfc" id="L1408" title="All 2 branches covered.">                for (Map.Entry entry : ((Map&lt;?, ?&gt;) obj).entrySet()) {</span>
<span class="fc" id="L1409">                    Object key = cast(entry.getKey(), keyType, mapping);</span>
<span class="fc" id="L1410">                    Object value = cast(entry.getValue(), valueType, mapping);</span>
<span class="fc" id="L1411">                    map.put(key, value);</span>
<span class="fc" id="L1412">                }</span>
<span class="fc" id="L1413">                return (T) map;</span>
            }
        }
<span class="fc bfc" id="L1416" title="All 2 branches covered.">        if (obj instanceof String) {</span>
<span class="fc" id="L1417">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1418" title="All 2 branches covered.">            if (strVal.length() == 0) {</span>
<span class="fc" id="L1419">                return null;</span>
            }
        }

<span class="fc" id="L1423">        Type[] actualTypeArguments = type.getActualTypeArguments();</span>
<span class="fc bfc" id="L1424" title="All 2 branches covered.">        if (actualTypeArguments.length == 1) {</span>
<span class="fc" id="L1425">            Type argType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1426" title="All 2 branches covered.">            if (argType instanceof WildcardType) {</span>
<span class="nc" id="L1427">                return (T) cast(obj, rawTye, mapping);</span>
            }
        }

<span class="pc bpc" id="L1431" title="2 of 6 branches missed.">        if (rawTye == Map.Entry.class &amp;&amp; obj instanceof Map &amp;&amp; ((Map) obj).size() == 1) {</span>
<span class="fc" id="L1432">            Map.Entry entry = (Map.Entry) ((Map) obj).entrySet().iterator().next();</span>
<span class="fc" id="L1433">            Object entryValue = entry.getValue();</span>
<span class="pc bpc" id="L1434" title="1 of 4 branches missed.">            if (actualTypeArguments.length == 2 &amp;&amp; entryValue instanceof Map) {</span>
<span class="fc" id="L1435">                Type valueType = actualTypeArguments[1];</span>
<span class="fc" id="L1436">                entry.setValue(</span>
<span class="fc" id="L1437">                        cast(entryValue, valueType, mapping)</span>
                );
            }
<span class="fc" id="L1440">            return (T) entry;</span>
        }

<span class="pc bpc" id="L1443" title="1 of 2 branches missed.">        if (rawTye instanceof Class) {</span>
<span class="fc bfc" id="L1444" title="All 2 branches covered.">            if (mapping == null) {</span>
<span class="fc" id="L1445">                mapping = ParserConfig.global;</span>
            }
<span class="fc" id="L1447">            ObjectDeserializer deserializer = mapping.getDeserializer(rawTye);</span>
<span class="pc bpc" id="L1448" title="1 of 2 branches missed.">            if (deserializer != null) {</span>
<span class="fc" id="L1449">                String str = JSON.toJSONString(obj);</span>
<span class="fc" id="L1450">                DefaultJSONParser parser = new DefaultJSONParser(str, mapping);</span>
<span class="fc" id="L1451">                return (T) deserializer.deserialze(parser, type, null);</span>
            }
        }

<span class="nc" id="L1455">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;})
    public static &lt;T&gt; T castToJavaBean(Map&lt;String, Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config) {
        try {
<span class="fc bfc" id="L1461" title="All 2 branches covered.">            if (clazz == StackTraceElement.class) {</span>
<span class="fc" id="L1462">                String declaringClass = (String) map.get(&quot;className&quot;);</span>
<span class="fc" id="L1463">                String methodName = (String) map.get(&quot;methodName&quot;);</span>
<span class="fc" id="L1464">                String fileName = (String) map.get(&quot;fileName&quot;);</span>
                int lineNumber;
                {
<span class="fc" id="L1467">                    Number value = (Number) map.get(&quot;lineNumber&quot;);</span>
<span class="fc bfc" id="L1468" title="All 2 branches covered.">                    if (value == null) {</span>
<span class="fc" id="L1469">                        lineNumber = 0;</span>
<span class="fc bfc" id="L1470" title="All 2 branches covered.">                    } else if (value instanceof BigDecimal) {</span>
<span class="nc" id="L1471">                        lineNumber = ((BigDecimal) value).intValueExact();</span>
                    } else {
<span class="fc" id="L1473">                        lineNumber = value.intValue();</span>
                    }
                }
<span class="fc" id="L1476">                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</span>
            }

            {
<span class="fc" id="L1480">                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</span>
<span class="fc bfc" id="L1481" title="All 2 branches covered.">                if (iClassObject instanceof String) {</span>
<span class="fc" id="L1482">                    String className = (String) iClassObject;</span>
                    Class&lt;?&gt; loadClazz;
<span class="fc bfc" id="L1484" title="All 2 branches covered.">                    if (config == null) {</span>
<span class="fc" id="L1485">                        config = ParserConfig.global;</span>
                    }
<span class="fc" id="L1487">                    loadClazz = config.checkAutoType(className, null);</span>
<span class="pc bpc" id="L1488" title="1 of 2 branches missed.">                    if (loadClazz == null) {</span>
<span class="nc" id="L1489">                        throw new ClassNotFoundException(className + &quot; not found&quot;);</span>
                    }
<span class="fc bfc" id="L1491" title="All 2 branches covered.">                    if (!loadClazz.equals(clazz)) {</span>
<span class="fc" id="L1492">                        return (T) castToJavaBean(map, loadClazz, config);</span>
                    }
                }
            }

<span class="fc bfc" id="L1497" title="All 2 branches covered.">            if (clazz.isInterface()) {</span>
                JSONObject object;
<span class="fc bfc" id="L1499" title="All 2 branches covered.">                if (map instanceof JSONObject) {</span>
<span class="fc" id="L1500">                    object = (JSONObject) map;</span>
                } else {
<span class="fc" id="L1502">                    object = new JSONObject(map);</span>
                }
<span class="fc bfc" id="L1504" title="All 2 branches covered.">                if (config == null) {</span>
<span class="fc" id="L1505">                    config = ParserConfig.getGlobalInstance();</span>
                }
<span class="fc" id="L1507">                ObjectDeserializer deserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1508" title="All 2 branches covered.">                if (deserializer != null) {</span>
<span class="fc" id="L1509">                    String json = JSON.toJSONString(object);</span>
<span class="fc" id="L1510">                    return JSON.parseObject(json, clazz);</span>
                }
<span class="fc" id="L1512">                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span>
                        new Class&lt;?&gt;[]{clazz}, object);
            }

<span class="fc bfc" id="L1516" title="All 2 branches covered.">            if (clazz == Locale.class) {</span>
<span class="fc" id="L1517">                Object arg0 = map.get(&quot;language&quot;);</span>
<span class="fc" id="L1518">                Object arg1 = map.get(&quot;country&quot;);</span>
<span class="pc bpc" id="L1519" title="1 of 2 branches missed.">                if (arg0 instanceof String) {</span>
<span class="fc" id="L1520">                    String language = (String) arg0;</span>
<span class="pc bpc" id="L1521" title="1 of 2 branches missed.">                    if (arg1 instanceof String) {</span>
<span class="fc" id="L1522">                        String country = (String) arg1;</span>
<span class="fc" id="L1523">                        return (T) new Locale(language, country);</span>
<span class="nc bnc" id="L1524" title="All 2 branches missed.">                    } else if (arg1 == null) {</span>
<span class="nc" id="L1525">                        return (T) new Locale(language);</span>
                    }
                }
            }

<span class="pc bpc" id="L1530" title="3 of 4 branches missed.">            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="nc" id="L1531">                return (T) map.toString();</span>
            }

<span class="pc bpc" id="L1534" title="1 of 4 branches missed.">            if (clazz == JSON.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1535">                return (T) map;</span>
            }

<span class="pc bpc" id="L1538" title="1 of 4 branches missed.">            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1539">                JSONObject jsonObject = (JSONObject) map;</span>
<span class="fc" id="L1540">                Map&lt;String, Object&gt; innerMap = jsonObject.getInnerMap();</span>
<span class="pc bpc" id="L1541" title="1 of 2 branches missed.">                if (innerMap instanceof LinkedHashMap) {</span>
<span class="fc" id="L1542">                    return (T) innerMap;</span>
                }
            }

<span class="fc bfc" id="L1546" title="All 2 branches covered.">            if (clazz.isInstance(map)) {</span>
<span class="fc" id="L1547">                return (T) map;</span>
            }

<span class="fc bfc" id="L1550" title="All 2 branches covered.">            if (clazz == JSONObject.class) {</span>
<span class="fc" id="L1551">                return (T) new JSONObject(map);</span>
            }

<span class="fc bfc" id="L1554" title="All 2 branches covered.">            if (config == null) {</span>
<span class="fc" id="L1555">                config = ParserConfig.getGlobalInstance();</span>
            }

<span class="fc" id="L1558">            JavaBeanDeserializer javaBeanDeser = null;</span>
<span class="fc" id="L1559">            ObjectDeserializer deserializer = config.getDeserializer(clazz);</span>
<span class="fc bfc" id="L1560" title="All 2 branches covered.">            if (deserializer instanceof JavaBeanDeserializer) {</span>
<span class="fc" id="L1561">                javaBeanDeser = (JavaBeanDeserializer) deserializer;</span>
            }

<span class="fc bfc" id="L1564" title="All 2 branches covered.">            if (javaBeanDeser == null) {</span>
<span class="fc" id="L1565">                throw new JSONException(&quot;can not get javaBeanDeserializer. &quot; + clazz.getName());</span>
            }
<span class="fc" id="L1567">            return (T) javaBeanDeser.createInstance(map, config);</span>
<span class="fc" id="L1568">        } catch (Exception e) {</span>
<span class="fc" id="L1569">            throw new JSONException(e.getMessage(), e);</span>
        }
    }

<span class="fc" id="L1573">    private static Function&lt;Map&lt;String, Class&lt;?&gt;&gt;, Void&gt; addBaseClassMappingsFunction =</span>
<span class="fc" id="L1574">            new Function&lt;Map&lt;String, Class&lt;?&gt;&gt;, Void&gt;() {</span>
                public Void apply(Map&lt;String, Class&lt;?&gt;&gt; mappings) {
<span class="fc" id="L1576">                    Class&lt;?&gt;[] classes = new Class[]{</span>
                            java.sql.Time.class,
                            java.sql.Date.class,
                            java.sql.Timestamp.class
                    };
<span class="fc bfc" id="L1581" title="All 2 branches covered.">                    for (Class clazz : classes) {</span>
<span class="pc bpc" id="L1582" title="1 of 2 branches missed.">                        if (clazz == null) {</span>
<span class="nc" id="L1583">                            continue;</span>
                        }
<span class="fc" id="L1585">                        mappings.put(clazz.getName(), clazz);</span>
                    }
<span class="fc" id="L1587">                    return null;</span>
                }
            };

    static {
<span class="fc" id="L1592">        addBaseClassMappings();</span>
    }

    private static void addBaseClassMappings() {
<span class="fc" id="L1596">        mappings.put(&quot;byte&quot;, byte.class);</span>
<span class="fc" id="L1597">        mappings.put(&quot;short&quot;, short.class);</span>
<span class="fc" id="L1598">        mappings.put(&quot;int&quot;, int.class);</span>
<span class="fc" id="L1599">        mappings.put(&quot;long&quot;, long.class);</span>
<span class="fc" id="L1600">        mappings.put(&quot;float&quot;, float.class);</span>
<span class="fc" id="L1601">        mappings.put(&quot;double&quot;, double.class);</span>
<span class="fc" id="L1602">        mappings.put(&quot;boolean&quot;, boolean.class);</span>
<span class="fc" id="L1603">        mappings.put(&quot;char&quot;, char.class);</span>
<span class="fc" id="L1604">        mappings.put(&quot;[byte&quot;, byte[].class);</span>
<span class="fc" id="L1605">        mappings.put(&quot;[short&quot;, short[].class);</span>
<span class="fc" id="L1606">        mappings.put(&quot;[int&quot;, int[].class);</span>
<span class="fc" id="L1607">        mappings.put(&quot;[long&quot;, long[].class);</span>
<span class="fc" id="L1608">        mappings.put(&quot;[float&quot;, float[].class);</span>
<span class="fc" id="L1609">        mappings.put(&quot;[double&quot;, double[].class);</span>
<span class="fc" id="L1610">        mappings.put(&quot;[boolean&quot;, boolean[].class);</span>
<span class="fc" id="L1611">        mappings.put(&quot;[char&quot;, char[].class);</span>
<span class="fc" id="L1612">        mappings.put(&quot;[B&quot;, byte[].class);</span>
<span class="fc" id="L1613">        mappings.put(&quot;[S&quot;, short[].class);</span>
<span class="fc" id="L1614">        mappings.put(&quot;[I&quot;, int[].class);</span>
<span class="fc" id="L1615">        mappings.put(&quot;[J&quot;, long[].class);</span>
<span class="fc" id="L1616">        mappings.put(&quot;[F&quot;, float[].class);</span>
<span class="fc" id="L1617">        mappings.put(&quot;[D&quot;, double[].class);</span>
<span class="fc" id="L1618">        mappings.put(&quot;[C&quot;, char[].class);</span>
<span class="fc" id="L1619">        mappings.put(&quot;[Z&quot;, boolean[].class);</span>
<span class="fc" id="L1620">        Class&lt;?&gt;[] classes = new Class[]{</span>
                Object.class,
                java.lang.Cloneable.class,
<span class="fc" id="L1623">                loadClass(&quot;java.lang.AutoCloseable&quot;),</span>
                java.lang.Exception.class,
                java.lang.RuntimeException.class,
                java.lang.IllegalAccessError.class,
                java.lang.IllegalAccessException.class,
                java.lang.IllegalArgumentException.class,
                java.lang.IllegalMonitorStateException.class,
                java.lang.IllegalStateException.class,
                java.lang.IllegalThreadStateException.class,
                java.lang.IndexOutOfBoundsException.class,
                java.lang.InstantiationError.class,
                java.lang.InstantiationException.class,
                java.lang.InternalError.class,
                java.lang.InterruptedException.class,
                java.lang.LinkageError.class,
                java.lang.NegativeArraySizeException.class,
                java.lang.NoClassDefFoundError.class,
                java.lang.NoSuchFieldError.class,
                java.lang.NoSuchFieldException.class,
                java.lang.NoSuchMethodError.class,
                java.lang.NoSuchMethodException.class,
                java.lang.NullPointerException.class,
                java.lang.NumberFormatException.class,
                java.lang.OutOfMemoryError.class,
                java.lang.SecurityException.class,
                java.lang.StackOverflowError.class,
                java.lang.StringIndexOutOfBoundsException.class,
                java.lang.TypeNotPresentException.class,
                java.lang.VerifyError.class,
                java.lang.StackTraceElement.class,
                java.util.HashMap.class,
                java.util.LinkedHashMap.class,
                java.util.Hashtable.class,
                java.util.TreeMap.class,
                java.util.IdentityHashMap.class,
                java.util.WeakHashMap.class,
                java.util.LinkedHashMap.class,
                java.util.HashSet.class,
                java.util.LinkedHashSet.class,
                java.util.TreeSet.class,
                java.util.ArrayList.class,
                java.util.concurrent.TimeUnit.class,
                java.util.concurrent.ConcurrentHashMap.class,
                java.util.concurrent.atomic.AtomicInteger.class,
                java.util.concurrent.atomic.AtomicLong.class,
<span class="fc" id="L1668">                java.util.Collections.EMPTY_MAP.getClass(),</span>
                java.lang.Boolean.class,
                java.lang.Character.class,
                java.lang.Byte.class,
                java.lang.Short.class,
                java.lang.Integer.class,
                java.lang.Long.class,
                java.lang.Float.class,
                java.lang.Double.class,
                java.lang.Number.class,
                java.lang.String.class,
                java.math.BigDecimal.class,
                java.math.BigInteger.class,
                java.util.BitSet.class,
                java.util.Calendar.class,
                java.util.Date.class,
                java.util.Locale.class,
                java.util.UUID.class,
                java.text.SimpleDateFormat.class,
                com.alibaba.fastjson.JSONObject.class,
                com.alibaba.fastjson.JSONPObject.class,
                com.alibaba.fastjson.JSONArray.class,
        };
<span class="fc bfc" id="L1691" title="All 2 branches covered.">        for (Class clazz : classes) {</span>
<span class="pc bpc" id="L1692" title="1 of 2 branches missed.">            if (clazz == null) {</span>
<span class="nc" id="L1693">                continue;</span>
            }
<span class="fc" id="L1695">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1697">        ModuleUtil.callWhenHasJavaSql(addBaseClassMappingsFunction, mappings);</span>
<span class="fc" id="L1698">    }</span>

    public static void clearClassMapping() {
<span class="fc" id="L1701">        mappings.clear();</span>
<span class="fc" id="L1702">        addBaseClassMappings();</span>
<span class="fc" id="L1703">    }</span>

    public static void addMapping(String className, Class&lt;?&gt; clazz) {
<span class="fc" id="L1706">        mappings.put(className, clazz);</span>
<span class="fc" id="L1707">    }</span>

    public static Class&lt;?&gt; loadClass(String className) {
<span class="fc" id="L1710">        return loadClass(className, null);</span>
    }

    public static boolean isPath(Class&lt;?&gt; clazz) {
<span class="pc bpc" id="L1714" title="1 of 4 branches missed.">        if (pathClass == null &amp;&amp; !pathClass_error) {</span>
            try {
<span class="fc" id="L1716">                pathClass = Class.forName(&quot;java.nio.file.Path&quot;);</span>
<span class="nc" id="L1717">            } catch (Throwable ex) {</span>
<span class="nc" id="L1718">                pathClass_error = true;</span>
<span class="fc" id="L1719">            }</span>
        }
<span class="pc bpc" id="L1721" title="1 of 2 branches missed.">        if (pathClass != null) {</span>
<span class="fc" id="L1722">            return pathClass.isAssignableFrom(clazz);</span>
        }
<span class="nc" id="L1724">        return false;</span>
    }

    public static Class&lt;?&gt; getClassFromMapping(String className) {
<span class="fc" id="L1728">        return mappings.get(className);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader) {
<span class="fc" id="L1732">        return loadClass(className, classLoader, false);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, boolean cache) {
<span class="fc bfc" id="L1736" title="All 4 branches covered.">        if (className == null || className.length() == 0) {</span>
<span class="fc" id="L1737">            return null;</span>
        }

<span class="pc bpc" id="L1740" title="1 of 2 branches missed.">        if (className.length() &gt; 198) {</span>
<span class="nc" id="L1741">            throw new JSONException(&quot;illegal className : &quot; + className);</span>
        }

<span class="fc" id="L1744">        Class&lt;?&gt; clazz = mappings.get(className);</span>
<span class="fc bfc" id="L1745" title="All 2 branches covered.">        if (clazz != null) {</span>
<span class="fc" id="L1746">            return clazz;</span>
        }

<span class="fc bfc" id="L1749" title="All 2 branches covered.">        if (className.charAt(0) == '[') {</span>
<span class="fc" id="L1750">            Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);</span>
<span class="fc" id="L1751">            return Array.newInstance(componentType, 0).getClass();</span>
        }

<span class="pc bpc" id="L1754" title="1 of 4 branches missed.">        if (className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)) {</span>
<span class="fc" id="L1755">            String newClassName = className.substring(1, className.length() - 1);</span>
<span class="fc" id="L1756">            return loadClass(newClassName, classLoader);</span>
        }

        try {
<span class="fc bfc" id="L1760" title="All 2 branches covered.">            if (classLoader != null) {</span>
<span class="fc" id="L1761">                clazz = classLoader.loadClass(className);</span>
<span class="pc bpc" id="L1762" title="1 of 2 branches missed.">                if (cache) {</span>
<span class="nc" id="L1763">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1765">                return clazz;</span>
            }
<span class="fc" id="L1767">        } catch (Throwable e) {</span>
<span class="fc" id="L1768">            e.printStackTrace();</span>
            // skip
<span class="fc" id="L1770">        }</span>
        try {
<span class="fc" id="L1772">            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="pc bpc" id="L1773" title="1 of 4 branches missed.">            if (contextClassLoader != null &amp;&amp; contextClassLoader != classLoader) {</span>
<span class="fc" id="L1774">                clazz = contextClassLoader.loadClass(className);</span>
<span class="fc bfc" id="L1775" title="All 2 branches covered.">                if (cache) {</span>
<span class="fc" id="L1776">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1778">                return clazz;</span>
            }
<span class="fc" id="L1780">        } catch (Throwable e) {</span>
            // skip
<span class="fc" id="L1782">        }</span>
        try {
<span class="fc" id="L1784">            clazz = Class.forName(className);</span>
<span class="pc bpc" id="L1785" title="1 of 2 branches missed.">            if (cache) {</span>
<span class="nc" id="L1786">                mappings.put(className, clazz);</span>
            }
<span class="fc" id="L1788">            return clazz;</span>
<span class="fc" id="L1789">        } catch (Throwable e) {</span>
            // skip
        }
<span class="fc" id="L1792">        return clazz;</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String, String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy) {
<span class="fc" id="L1798">        return buildBeanInfo(beanType, aliasMap, propertyNamingStrategy, false);</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String, String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy //
            , boolean fieldBased //
    ) {
<span class="fc" id="L1806">        JSONType jsonType = TypeUtils.getAnnotation(beanType, JSONType.class);</span>
<span class="fc" id="L1807">        String[] orders = null;</span>
        final int features;
<span class="fc" id="L1809">        String typeName = null, typeKey = null;</span>
<span class="fc bfc" id="L1810" title="All 2 branches covered.">        if (jsonType != null) {</span>
<span class="fc" id="L1811">            orders = jsonType.orders();</span>

<span class="fc" id="L1813">            typeName = jsonType.typeName();</span>
<span class="fc bfc" id="L1814" title="All 2 branches covered.">            if (typeName.length() == 0) {</span>
<span class="fc" id="L1815">                typeName = null;</span>
            }

<span class="fc" id="L1818">            PropertyNamingStrategy jsonTypeNaming = jsonType.naming();</span>
<span class="fc bfc" id="L1819" title="All 2 branches covered.">            if (jsonTypeNaming != PropertyNamingStrategy.NeverUseThisValueExceptDefaultValue) {</span>
<span class="fc" id="L1820">                propertyNamingStrategy = jsonTypeNaming;</span>
            }

<span class="fc" id="L1823">            features = SerializerFeature.of(jsonType.serialzeFeatures());</span>
<span class="fc" id="L1824">            for (Class&lt;?&gt; supperClass = beanType.getSuperclass()</span>
<span class="pc bpc" id="L1825" title="1 of 4 branches missed.">                 ; supperClass != null &amp;&amp; supperClass != Object.class</span>
<span class="fc" id="L1826">                    ; supperClass = supperClass.getSuperclass()) {</span>
<span class="fc" id="L1827">                JSONType superJsonType = TypeUtils.getAnnotation(supperClass, JSONType.class);</span>
<span class="fc bfc" id="L1828" title="All 2 branches covered.">                if (superJsonType == null) {</span>
<span class="fc" id="L1829">                    break;</span>
                }
<span class="fc" id="L1831">                typeKey = superJsonType.typeKey();</span>
<span class="fc bfc" id="L1832" title="All 2 branches covered.">                if (typeKey.length() != 0) {</span>
<span class="fc" id="L1833">                    break;</span>
                }
            }

<span class="fc bfc" id="L1837" title="All 2 branches covered.">            for (Class&lt;?&gt; interfaceClass : beanType.getInterfaces()) {</span>
<span class="fc" id="L1838">                JSONType superJsonType = TypeUtils.getAnnotation(interfaceClass, JSONType.class);</span>
<span class="fc bfc" id="L1839" title="All 2 branches covered.">                if (superJsonType != null) {</span>
<span class="fc" id="L1840">                    typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1841" title="1 of 2 branches missed.">                    if (typeKey.length() != 0) {</span>
<span class="fc" id="L1842">                        break;</span>
                    }
                }
            }

<span class="fc bfc" id="L1847" title="All 4 branches covered.">            if (typeKey != null &amp;&amp; typeKey.length() == 0) {</span>
<span class="fc" id="L1848">                typeKey = null;</span>
            }
<span class="fc" id="L1850">        } else {</span>
<span class="fc" id="L1851">            features = 0;</span>
        }
        // fieldName,field ，先生成fieldName的快照，减少之后的findField的轮询
<span class="fc" id="L1854">        Map&lt;String, Field&gt; fieldCacheMap = new HashMap&lt;String, Field&gt;();</span>
<span class="fc" id="L1855">        ParserConfig.parserAllFieldToCache(beanType, fieldCacheMap);</span>
<span class="fc bfc" id="L1856" title="All 2 branches covered.">        List&lt;FieldInfo&gt; fieldInfoList = fieldBased</span>
<span class="fc" id="L1857">                ? computeGettersWithFieldBase(beanType, aliasMap, false, propertyNamingStrategy) //</span>
<span class="fc" id="L1858">                : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</span>
<span class="fc" id="L1859">        FieldInfo[] fields = new FieldInfo[fieldInfoList.size()];</span>
<span class="fc" id="L1860">        fieldInfoList.toArray(fields);</span>
        FieldInfo[] sortedFields;
        List&lt;FieldInfo&gt; sortedFieldList;
<span class="fc bfc" id="L1863" title="All 4 branches covered.">        if (orders != null &amp;&amp; orders.length != 0) {</span>
<span class="pc bpc" id="L1864" title="1 of 2 branches missed.">            sortedFieldList = fieldBased</span>
<span class="pc" id="L1865">                    ? computeGettersWithFieldBase(beanType, aliasMap, true, propertyNamingStrategy) //</span>
<span class="fc" id="L1866">                    : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, true, propertyNamingStrategy);</span>
        } else {
<span class="fc" id="L1868">            sortedFieldList = new ArrayList&lt;FieldInfo&gt;(fieldInfoList);</span>
<span class="fc" id="L1869">            Collections.sort(sortedFieldList);</span>
        }
<span class="fc" id="L1871">        sortedFields = new FieldInfo[sortedFieldList.size()];</span>
<span class="fc" id="L1872">        sortedFieldList.toArray(sortedFields);</span>
<span class="fc bfc" id="L1873" title="All 2 branches covered.">        if (Arrays.equals(sortedFields, fields)) {</span>
<span class="fc" id="L1874">            sortedFields = fields;</span>
        }
<span class="fc" id="L1876">        return new SerializeBeanInfo(beanType, jsonType, typeName, typeKey, features, fields, sortedFields);</span>
    }

    public static List&lt;FieldInfo&gt; computeGettersWithFieldBase(
            Class&lt;?&gt; clazz, //
            Map&lt;String, String&gt; aliasMap, //
            boolean sorted, //
            PropertyNamingStrategy propertyNamingStrategy) {
<span class="fc" id="L1884">        Map&lt;String, FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String, FieldInfo&gt;();</span>
<span class="fc bfc" id="L1885" title="All 2 branches covered.">        for (Class&lt;?&gt; currentClass = clazz; currentClass != null; currentClass = currentClass.getSuperclass()) {</span>
<span class="fc" id="L1886">            Field[] fields = currentClass.getDeclaredFields();</span>
<span class="fc" id="L1887">            computeFields(currentClass, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
        }
<span class="fc" id="L1889">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String, String&gt; aliasMap) {
<span class="fc" id="L1893">        return computeGetters(clazz, aliasMap, true);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String, String&gt; aliasMap, boolean sorted) {
<span class="fc" id="L1897">        JSONType jsonType = TypeUtils.getAnnotation(clazz, JSONType.class);</span>
<span class="fc" id="L1898">        Map&lt;String, Field&gt; fieldCacheMap = new HashMap&lt;String, Field&gt;();</span>
<span class="fc" id="L1899">        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</span>
<span class="fc" id="L1900">        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
                                                 JSONType jsonType, //
                                                 Map&lt;String, String&gt; aliasMap, //
                                                 Map&lt;String, Field&gt; fieldCacheMap, //
                                                 boolean sorted, //
                                                 PropertyNamingStrategy propertyNamingStrategy //
    ) {
<span class="fc" id="L1910">        Map&lt;String, FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String, FieldInfo&gt;();</span>
<span class="fc" id="L1911">        boolean kotlin = TypeUtils.isKotlin(clazz);</span>
        // for kotlin
<span class="fc" id="L1913">        Constructor[] constructors = null;</span>
<span class="fc" id="L1914">        Annotation[][] paramAnnotationArrays = null;</span>
<span class="fc" id="L1915">        String[] paramNames = null;</span>
<span class="fc" id="L1916">        short[] paramNameMapping = null;</span>
<span class="fc" id="L1917">        Method[] methods = clazz.getMethods();</span>
        try {
<span class="fc" id="L1919">            Arrays.sort(methods, new MethodInheritanceComparator());</span>
<span class="nc" id="L1920">        } catch (Throwable ignored) {</span>

<span class="fc" id="L1922">        }</span>

<span class="fc bfc" id="L1924" title="All 2 branches covered.">        for (Method method : methods) {</span>
<span class="fc" id="L1925">            String methodName = method.getName();</span>
<span class="fc" id="L1926">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1927">            String label = null;</span>
<span class="fc bfc" id="L1928" title="All 2 branches covered.">            if (Modifier.isStatic(method.getModifiers())) {</span>
<span class="fc" id="L1929">                continue;</span>
            }

<span class="fc" id="L1932">            Class&lt;?&gt; returnType = method.getReturnType();</span>
<span class="fc bfc" id="L1933" title="All 2 branches covered.">            if (returnType.equals(Void.TYPE)) {</span>
<span class="fc" id="L1934">                continue;</span>
            }

<span class="fc bfc" id="L1937" title="All 2 branches covered.">            if (method.getParameterTypes().length != 0) {</span>
<span class="fc" id="L1938">                continue;</span>
            }

<span class="fc bfc" id="L1941" title="All 6 branches covered.">            if (returnType == ClassLoader.class</span>
                    || returnType == InputStream.class
                    || returnType == Reader.class) {
<span class="fc" id="L1944">                continue;</span>
            }

<span class="fc bfc" id="L1947" title="All 2 branches covered.">            if (methodName.equals(&quot;getMetaClass&quot;)</span>
<span class="pc bpc" id="L1948" title="1 of 2 branches missed.">                    &amp;&amp; returnType.getName().equals(&quot;groovy.lang.MetaClass&quot;)) {</span>
<span class="fc" id="L1949">                continue;</span>
            }
<span class="fc bfc" id="L1951" title="All 2 branches covered.">            if (methodName.equals(&quot;getSuppressed&quot;)</span>
<span class="pc bpc" id="L1952" title="1 of 2 branches missed.">                    &amp;&amp; method.getDeclaringClass() == Throwable.class) {</span>
<span class="fc" id="L1953">                continue;</span>
            }

<span class="fc bfc" id="L1956" title="All 4 branches covered.">            if (kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)) {</span>
<span class="fc" id="L1957">                continue;</span>
            }
            /**
             *  如果在属性或者方法上存在JSONField注解，并且定制了name属性，不以类上的propertyNamingStrategy设置为准，以此字段的JSONField的name定制为准。
             */
<span class="fc" id="L1962">            Boolean fieldAnnotationAndNameExists = false;</span>
<span class="fc" id="L1963">            JSONField annotation = TypeUtils.getAnnotation(method, JSONField.class);</span>
<span class="fc bfc" id="L1964" title="All 2 branches covered.">            if (annotation == null) {</span>
<span class="fc" id="L1965">                annotation = getSuperMethodAnnotation(clazz, method);</span>
            }
<span class="fc bfc" id="L1967" title="All 4 branches covered.">            if (annotation == null &amp;&amp; kotlin) {</span>
<span class="fc bfc" id="L1968" title="All 2 branches covered.">                if (constructors == null) {</span>
<span class="fc" id="L1969">                    constructors = clazz.getDeclaredConstructors();</span>
<span class="fc" id="L1970">                    Constructor creatorConstructor = TypeUtils.getKotlinConstructor(constructors);</span>
<span class="pc bpc" id="L1971" title="1 of 2 branches missed.">                    if (creatorConstructor != null) {</span>
<span class="fc" id="L1972">                        paramAnnotationArrays = TypeUtils.getParameterAnnotations(creatorConstructor);</span>
<span class="fc" id="L1973">                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</span>
<span class="pc bpc" id="L1974" title="1 of 2 branches missed.">                        if (paramNames != null) {</span>
<span class="fc" id="L1975">                            String[] paramNames_sorted = new String[paramNames.length];</span>
<span class="fc" id="L1976">                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</span>

<span class="fc" id="L1978">                            Arrays.sort(paramNames_sorted);</span>
<span class="fc" id="L1979">                            paramNameMapping = new short[paramNames.length];</span>
<span class="fc bfc" id="L1980" title="All 2 branches covered.">                            for (short p = 0; p &lt; paramNames.length; p++) {</span>
<span class="fc" id="L1981">                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</span>
<span class="fc" id="L1982">                                paramNameMapping[index] = p;</span>
                            }
<span class="fc" id="L1984">                            paramNames = paramNames_sorted;</span>
                        }
                    }
                }
<span class="pc bpc" id="L1988" title="2 of 6 branches missed.">                if (paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)) {</span>
<span class="fc" id="L1989">                    String propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1990">                    int p = Arrays.binarySearch(paramNames, propertyName);</span>
<span class="fc bfc" id="L1991" title="All 2 branches covered.">                    if (p &lt; 0) {</span>
<span class="fc bfc" id="L1992" title="All 2 branches covered.">                        for (int i = 0; i &lt; paramNames.length; i++) {</span>
<span class="fc bfc" id="L1993" title="All 2 branches covered.">                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</span>
<span class="fc" id="L1994">                                p = i;</span>
<span class="fc" id="L1995">                                break;</span>
                            }
                        }
                    }
<span class="fc bfc" id="L1999" title="All 2 branches covered.">                    if (p &gt;= 0) {</span>
<span class="fc" id="L2000">                        short index = paramNameMapping[p];</span>
<span class="fc" id="L2001">                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</span>
<span class="pc bpc" id="L2002" title="1 of 2 branches missed.">                        if (paramAnnotations != null) {</span>
<span class="pc bfc" id="L2003" title="All 2 branches covered.">                            for (Annotation paramAnnotation : paramAnnotations) {</span>
<span class="pc bpc" id="L2004" title="1 of 2 branches missed.">                                if (paramAnnotation instanceof JSONField) {</span>
<span class="fc" id="L2005">                                    annotation = (JSONField) paramAnnotation;</span>
<span class="fc" id="L2006">                                    break;</span>
                                }
                            }
                        }
<span class="fc bfc" id="L2010" title="All 2 branches covered.">                        if (annotation == null) {</span>
<span class="fc" id="L2011">                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L2012" title="All 2 branches covered.">                            if (field != null) {</span>
<span class="fc" id="L2013">                                annotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
                            }
                        }
                    }
                }
            }
<span class="fc bfc" id="L2019" title="All 2 branches covered.">            if (annotation != null) {</span>
<span class="fc bfc" id="L2020" title="All 2 branches covered.">                if (!annotation.serialize()) {</span>
<span class="fc" id="L2021">                    continue;</span>
                }
<span class="fc" id="L2023">                ordinal = annotation.ordinal();</span>
<span class="fc" id="L2024">                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span>
<span class="fc" id="L2025">                parserFeatures = Feature.of(annotation.parseFeatures());</span>
<span class="fc bfc" id="L2026" title="All 2 branches covered.">                if (annotation.name().length() != 0) {</span>
<span class="fc" id="L2027">                    String propertyName = annotation.name();</span>
<span class="fc bfc" id="L2028" title="All 2 branches covered.">                    if (aliasMap != null) {</span>
<span class="fc" id="L2029">                        propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2030" title="1 of 2 branches missed.">                        if (propertyName == null) {</span>
<span class="fc" id="L2031">                            continue;</span>
                        }
                    }
<span class="fc" id="L2034">                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</span>
                            serialzeFeatures, parserFeatures, annotation, null, label);
<span class="fc" id="L2036">                    fieldInfoMap.put(propertyName, fieldInfo);</span>
<span class="fc" id="L2037">                    continue;</span>
                }
<span class="fc bfc" id="L2039" title="All 2 branches covered.">                if (annotation.label().length() != 0) {</span>
<span class="fc" id="L2040">                    label = annotation.label();</span>
                }
            }
<span class="fc bfc" id="L2043" title="All 2 branches covered.">            if (methodName.startsWith(&quot;get&quot;)) {</span>
<span class="fc bfc" id="L2044" title="All 2 branches covered.">                if (methodName.length() &lt; 4) {</span>
<span class="fc" id="L2045">                    continue;</span>
                }
<span class="fc bfc" id="L2047" title="All 2 branches covered.">                if (methodName.equals(&quot;getClass&quot;)) {</span>
<span class="fc" id="L2048">                    continue;</span>
                }
<span class="fc bfc" id="L2050" title="All 4 branches covered.">                if (methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()) {</span>
<span class="fc" id="L2051">                    continue;</span>
                }
<span class="fc" id="L2053">                char c3 = methodName.charAt(3);</span>
                String propertyName;
<span class="fc" id="L2055">                Field field = null;</span>
<span class="fc bfc" id="L2056" title="All 4 branches covered.">                if (Character.isUpperCase(c3) //</span>
                        || c3 &gt; 512 // for unicode method name
                ) {
<span class="fc bfc" id="L2059" title="All 2 branches covered.">                    if (compatibleWithJavaBean) {</span>
<span class="fc" id="L2060">                        propertyName = decapitalize(methodName.substring(3));</span>
                    } else {
<span class="fc" id="L2062">                        propertyName = TypeUtils.getPropertyNameByMethodName(methodName);</span>
                    }
<span class="fc" id="L2064">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</span>
<span class="fc bfc" id="L2065" title="All 2 branches covered.">                } else if (c3 == '_') {</span>
<span class="fc" id="L2066">                    propertyName = methodName.substring(3);</span>
<span class="fc" id="L2067">                    field = fieldCacheMap.get(propertyName);</span>
<span class="fc bfc" id="L2068" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2069">                        String temp = propertyName;</span>
<span class="fc" id="L2070">                        propertyName = methodName.substring(4);</span>
<span class="fc" id="L2071">                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L2072" title="All 2 branches covered.">                        if (field == null) {</span>
<span class="fc" id="L2073">                            propertyName = temp; //减少修改代码带来的影响</span>
                        }
<span class="fc" id="L2075">                    }</span>
<span class="fc bfc" id="L2076" title="All 2 branches covered.">                } else if (c3 == 'f') {</span>
<span class="fc" id="L2077">                    propertyName = methodName.substring(3);</span>
<span class="fc bfc" id="L2078" title="All 4 branches covered.">                } else if (methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))) {</span>
<span class="fc" id="L2079">                    propertyName = decapitalize(methodName.substring(3));</span>
                } else {
<span class="fc" id="L2081">                    propertyName = methodName.substring(3);</span>
<span class="fc" id="L2082">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L2083" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2084">                        continue;</span>
                    }
                }
<span class="fc" id="L2087">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L2088" title="All 2 branches covered.">                if (ignore) {</span>
<span class="fc" id="L2089">                    continue;</span>
                }

<span class="fc bfc" id="L2092" title="All 2 branches covered.">                if (field == null) {</span>
                    // 假如bean的field很多的情况一下，轮询时将大大降低效率
<span class="fc" id="L2094">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
                }

<span class="fc bfc" id="L2097" title="All 4 branches covered.">                if (field == null &amp;&amp; propertyName.length() &gt; 1) {</span>
<span class="fc" id="L2098">                    char ch = propertyName.charAt(1);</span>
<span class="fc bfc" id="L2099" title="All 4 branches covered.">                    if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z') {</span>
<span class="fc" id="L2100">                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L2101">                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</span>
                    }
                }
<span class="fc" id="L2104">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L2105" title="All 2 branches covered.">                if (field != null) {</span>
<span class="fc" id="L2106">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L2107" title="All 2 branches covered.">                    if (fieldAnnotation != null) {</span>
<span class="fc bfc" id="L2108" title="All 2 branches covered.">                        if (!fieldAnnotation.serialize()) {</span>
<span class="fc" id="L2109">                            continue;</span>
                        }
<span class="fc" id="L2111">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2112">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2113">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2114" title="All 2 branches covered.">                        if (fieldAnnotation.name().length() != 0) {</span>
<span class="fc" id="L2115">                            fieldAnnotationAndNameExists = true;</span>
<span class="fc" id="L2116">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L2117" title="All 2 branches covered.">                            if (aliasMap != null) {</span>
<span class="fc" id="L2118">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2119" title="1 of 2 branches missed.">                                if (propertyName == null) {</span>
<span class="fc" id="L2120">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L2124" title="1 of 2 branches missed.">                        if (fieldAnnotation.label().length() != 0) {</span>
<span class="nc" id="L2125">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L2129" title="All 2 branches covered.">                if (aliasMap != null) {</span>
<span class="fc" id="L2130">                    propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L2131" title="All 2 branches covered.">                    if (propertyName == null) {</span>
<span class="fc" id="L2132">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L2135" title="All 4 branches covered.">                if (propertyNamingStrategy != null &amp;&amp; !fieldAnnotationAndNameExists) {</span>
<span class="fc" id="L2136">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
<span class="fc" id="L2138">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L2140">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
<span class="fc bfc" id="L2142" title="All 2 branches covered.">            if (methodName.startsWith(&quot;is&quot;)) {</span>
<span class="fc bfc" id="L2143" title="All 2 branches covered.">                if (methodName.length() &lt; 3) {</span>
<span class="fc" id="L2144">                    continue;</span>
                }
<span class="fc bfc" id="L2146" title="All 4 branches covered.">                if (returnType != Boolean.TYPE</span>
                        &amp;&amp; returnType != Boolean.class) {
<span class="fc" id="L2148">                    continue;</span>
                }
<span class="fc" id="L2150">                char c2 = methodName.charAt(2);</span>
                String propertyName;
<span class="fc" id="L2152">                Field field = null;</span>
<span class="fc bfc" id="L2153" title="All 2 branches covered.">                if (Character.isUpperCase(c2)) {</span>
<span class="fc bfc" id="L2154" title="All 2 branches covered.">                    if (compatibleWithJavaBean) {</span>
<span class="fc" id="L2155">                        propertyName = decapitalize(methodName.substring(2));</span>
                    } else {
<span class="fc" id="L2157">                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</span>
                    }
<span class="fc" id="L2159">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</span>
<span class="fc bfc" id="L2160" title="All 2 branches covered.">                } else if (c2 == '_') {</span>
<span class="fc" id="L2161">                    propertyName = methodName.substring(3);</span>
<span class="fc" id="L2162">                    field = fieldCacheMap.get(propertyName);</span>
<span class="fc bfc" id="L2163" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2164">                        String temp = propertyName;</span>
<span class="fc" id="L2165">                        propertyName = methodName.substring(2);</span>
<span class="fc" id="L2166">                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="pc bpc" id="L2167" title="1 of 2 branches missed.">                        if (field == null) {</span>
<span class="nc" id="L2168">                            propertyName = temp;</span>
                        }
<span class="fc" id="L2170">                    }</span>
<span class="fc bfc" id="L2171" title="All 2 branches covered.">                } else if (c2 == 'f') {</span>
<span class="fc" id="L2172">                    propertyName = methodName.substring(2);</span>
                } else {
<span class="fc" id="L2174">                    propertyName = methodName.substring(2);</span>
<span class="fc" id="L2175">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L2176" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2177">                        continue;</span>
                    }
                }
<span class="fc" id="L2180">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L2181" title="All 2 branches covered.">                if (ignore) {</span>
<span class="fc" id="L2182">                    continue;</span>
                }

<span class="fc bfc" id="L2185" title="All 2 branches covered.">                if (field == null) {</span>
<span class="fc" id="L2186">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
                }

<span class="fc bfc" id="L2189" title="All 2 branches covered.">                if (field == null) {</span>
<span class="fc" id="L2190">                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</span>
                }
<span class="fc" id="L2192">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L2193" title="All 2 branches covered.">                if (field != null) {</span>
<span class="fc" id="L2194">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L2195" title="All 2 branches covered.">                    if (fieldAnnotation != null) {</span>
<span class="fc bfc" id="L2196" title="All 2 branches covered.">                        if (!fieldAnnotation.serialize()) {</span>
<span class="fc" id="L2197">                            continue;</span>
                        }
<span class="fc" id="L2199">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2200">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2201">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2202" title="All 2 branches covered.">                        if (fieldAnnotation.name().length() != 0) {</span>
<span class="fc" id="L2203">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L2204" title="All 2 branches covered.">                            if (aliasMap != null) {</span>
<span class="fc" id="L2205">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2206" title="1 of 2 branches missed.">                                if (propertyName == null) {</span>
<span class="fc" id="L2207">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L2211" title="1 of 2 branches missed.">                        if (fieldAnnotation.label().length() != 0) {</span>
<span class="nc" id="L2212">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L2216" title="All 2 branches covered.">                if (aliasMap != null) {</span>
<span class="fc" id="L2217">                    propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2218" title="1 of 2 branches missed.">                    if (propertyName == null) {</span>
<span class="fc" id="L2219">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L2222" title="All 2 branches covered.">                if (propertyNamingStrategy != null) {</span>
<span class="fc" id="L2223">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
                //优先选择get
<span class="fc bfc" id="L2226" title="All 2 branches covered.">                if (fieldInfoMap.containsKey(propertyName)) {</span>
<span class="fc" id="L2227">                    continue;</span>
                }
<span class="fc" id="L2229">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L2231">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2234">        Field[] fields = clazz.getFields();</span>
<span class="fc" id="L2235">        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
<span class="fc" id="L2236">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String, FieldInfo&gt; fieldInfoMap) {
<span class="fc" id="L2240">        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</span>
<span class="fc" id="L2241">        String[] orders = null;</span>
<span class="fc" id="L2242">        JSONType annotation = TypeUtils.getAnnotation(clazz, JSONType.class);</span>
<span class="fc bfc" id="L2243" title="All 2 branches covered.">        if (annotation != null) {</span>
<span class="fc" id="L2244">            orders = annotation.orders();</span>
        }
<span class="fc bfc" id="L2246" title="All 4 branches covered.">        if (orders != null &amp;&amp; orders.length &gt; 0) {</span>
<span class="fc" id="L2247">            LinkedHashMap&lt;String, FieldInfo&gt; map = new LinkedHashMap&lt;String, FieldInfo&gt;(fieldInfoMap.size());</span>
<span class="fc bfc" id="L2248" title="All 2 branches covered.">            for (FieldInfo field : fieldInfoMap.values()) {</span>
<span class="fc" id="L2249">                map.put(field.name, field);</span>
<span class="fc" id="L2250">            }</span>
<span class="fc bfc" id="L2251" title="All 2 branches covered.">            for (String item : orders) {</span>
<span class="fc" id="L2252">                FieldInfo field = map.get(item);</span>
<span class="fc bfc" id="L2253" title="All 2 branches covered.">                if (field != null) {</span>
<span class="fc" id="L2254">                    fieldInfoList.add(field);</span>
<span class="fc" id="L2255">                    map.remove(item);</span>
                }
            }
<span class="fc" id="L2258">            fieldInfoList.addAll(map.values());</span>
<span class="fc" id="L2259">        } else {</span>
<span class="fc" id="L2260">            fieldInfoList.addAll(fieldInfoMap.values());</span>
<span class="fc bfc" id="L2261" title="All 2 branches covered.">            if (sorted) {</span>
<span class="fc" id="L2262">                Collections.sort(fieldInfoList);</span>
            }
        }
<span class="fc" id="L2265">        return fieldInfoList;</span>
    }

    private static void computeFields(
            Class&lt;?&gt; clazz, //
            Map&lt;String, String&gt; aliasMap, //
            PropertyNamingStrategy propertyNamingStrategy, //
            Map&lt;String, FieldInfo&gt; fieldInfoMap, //
            Field[] fields) {
<span class="fc bfc" id="L2274" title="All 2 branches covered.">        for (Field field : fields) {</span>
<span class="fc bfc" id="L2275" title="All 2 branches covered.">            if (Modifier.isStatic(field.getModifiers())) {</span>
<span class="fc" id="L2276">                continue;</span>
            }
<span class="fc" id="L2278">            JSONField fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc" id="L2279">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L2280">            String propertyName = field.getName();</span>
<span class="fc" id="L2281">            String label = null;</span>
<span class="fc bfc" id="L2282" title="All 2 branches covered.">            if (fieldAnnotation != null) {</span>
<span class="fc bfc" id="L2283" title="All 2 branches covered.">                if (!fieldAnnotation.serialize()) {</span>
<span class="fc" id="L2284">                    continue;</span>
                }
<span class="fc" id="L2286">                ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2287">                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2288">                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2289" title="All 2 branches covered.">                if (fieldAnnotation.name().length() != 0) {</span>
<span class="fc" id="L2290">                    propertyName = fieldAnnotation.name();</span>
                }
<span class="pc bpc" id="L2292" title="1 of 2 branches missed.">                if (fieldAnnotation.label().length() != 0) {</span>
<span class="nc" id="L2293">                    label = fieldAnnotation.label();</span>
                }
            }
<span class="fc bfc" id="L2296" title="All 2 branches covered.">            if (aliasMap != null) {</span>
<span class="fc" id="L2297">                propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L2298" title="All 2 branches covered.">                if (propertyName == null) {</span>
<span class="fc" id="L2299">                    continue;</span>
                }
            }
<span class="fc bfc" id="L2302" title="All 2 branches covered.">            if (propertyNamingStrategy != null) {</span>
<span class="fc" id="L2303">                propertyName = propertyNamingStrategy.translate(propertyName);</span>
            }
<span class="fc bfc" id="L2305" title="All 2 branches covered.">            if (!fieldInfoMap.containsKey(propertyName)) {</span>
<span class="fc" id="L2306">                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        null, fieldAnnotation, label);
<span class="fc" id="L2308">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2311">    }</span>

    private static String getPropertyNameByCompatibleFieldName(Map&lt;String, Field&gt; fieldCacheMap, String methodName,
                                                               String propertyName, int fromIdx) {
<span class="pc bpc" id="L2315" title="1 of 2 branches missed.">        if (compatibleWithFieldName) {</span>
<span class="nc bnc" id="L2316" title="All 2 branches missed.">            if (!fieldCacheMap.containsKey(propertyName)) {</span>
<span class="nc" id="L2317">                String tempPropertyName = methodName.substring(fromIdx);</span>
<span class="nc bnc" id="L2318" title="All 2 branches missed.">                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</span>
            }
        }
<span class="fc" id="L2321">        return propertyName;</span>
    }

    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method) {
<span class="fc" id="L2325">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="fc bfc" id="L2326" title="All 2 branches covered.">        if (interfaces.length &gt; 0) {</span>
<span class="fc" id="L2327">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2328" title="All 2 branches covered.">            for (Class&lt;?&gt; interfaceClass : interfaces) {</span>
<span class="fc bfc" id="L2329" title="All 2 branches covered.">                for (Method interfaceMethod : interfaceClass.getMethods()) {</span>
<span class="fc" id="L2330">                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2331" title="All 2 branches covered.">                    if (interfaceTypes.length != types.length) {</span>
<span class="fc" id="L2332">                        continue;</span>
                    }
<span class="fc bfc" id="L2334" title="All 2 branches covered.">                    if (!interfaceMethod.getName().equals(method.getName())) {</span>
<span class="fc" id="L2335">                        continue;</span>
                    }
<span class="fc" id="L2337">                    boolean match = true;</span>
<span class="fc bfc" id="L2338" title="All 2 branches covered.">                    for (int i = 0; i &lt; types.length; ++i) {</span>
<span class="fc bfc" id="L2339" title="All 2 branches covered.">                        if (!interfaceTypes[i].equals(types[i])) {</span>
<span class="fc" id="L2340">                            match = false;</span>
<span class="fc" id="L2341">                            break;</span>
                        }
                    }
<span class="fc bfc" id="L2344" title="All 2 branches covered.">                    if (!match) {</span>
<span class="fc" id="L2345">                        continue;</span>
                    }
<span class="fc" id="L2347">                    JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2348" title="All 2 branches covered.">                    if (annotation != null) {</span>
<span class="fc" id="L2349">                        return annotation;</span>
                    }
                }
            }
        }
<span class="fc" id="L2354">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2355" title="All 2 branches covered.">        if (superClass == null) {</span>
<span class="fc" id="L2356">            return null;</span>
        }
<span class="fc bfc" id="L2358" title="All 2 branches covered.">        if (Modifier.isAbstract(superClass.getModifiers())) {</span>
<span class="fc" id="L2359">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2360" title="All 2 branches covered.">            for (Method interfaceMethod : superClass.getMethods()) {</span>
<span class="fc" id="L2361">                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2362" title="All 2 branches covered.">                if (interfaceTypes.length != types.length) {</span>
<span class="fc" id="L2363">                    continue;</span>
                }
<span class="fc bfc" id="L2365" title="All 2 branches covered.">                if (!interfaceMethod.getName().equals(method.getName())) {</span>
<span class="fc" id="L2366">                    continue;</span>
                }
<span class="fc" id="L2368">                boolean match = true;</span>
<span class="fc bfc" id="L2369" title="All 2 branches covered.">                for (int i = 0; i &lt; types.length; ++i) {</span>
<span class="pc bpc" id="L2370" title="1 of 2 branches missed.">                    if (!interfaceTypes[i].equals(types[i])) {</span>
<span class="nc" id="L2371">                        match = false;</span>
<span class="nc" id="L2372">                        break;</span>
                    }
                }
<span class="pc bpc" id="L2375" title="1 of 2 branches missed.">                if (!match) {</span>
<span class="nc" id="L2376">                    continue;</span>
                }
<span class="fc" id="L2378">                JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2379" title="All 2 branches covered.">                if (annotation != null) {</span>
<span class="fc" id="L2380">                    return annotation;</span>
                }
            }
        }
<span class="fc" id="L2384">        return null;</span>
    }

    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName) {
<span class="fc" id="L2388">        JSONType jsonType = TypeUtils.getAnnotation(clazz, JSONType.class);</span>
<span class="fc bfc" id="L2389" title="All 2 branches covered.">        if (jsonType != null) {</span>
            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<span class="fc" id="L2393">            String[] fields = jsonType.includes();</span>
<span class="fc bfc" id="L2394" title="All 2 branches covered.">            if (fields.length &gt; 0) {</span>
<span class="fc bfc" id="L2395" title="All 2 branches covered.">                for (String field : fields) {</span>
<span class="fc bfc" id="L2396" title="All 2 branches covered.">                    if (propertyName.equals(field)) {</span>
<span class="fc" id="L2397">                        return false;</span>
                    }
                }
<span class="fc" id="L2400">                return true;</span>
            } else {
<span class="fc" id="L2402">                fields = jsonType.ignores();</span>
<span class="fc bfc" id="L2403" title="All 2 branches covered.">                for (String field : fields) {</span>
<span class="fc bfc" id="L2404" title="All 2 branches covered.">                    if (propertyName.equals(field)) {</span>
<span class="fc" id="L2405">                        return true;</span>
                    }
                }
            }
        }
<span class="fc bfc" id="L2410" title="All 4 branches covered.">        if (clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null) {</span>
<span class="fc" id="L2411">            return isJSONTypeIgnore(clazz.getSuperclass(), propertyName);</span>
        }
<span class="fc" id="L2413">        return false;</span>
    }

    public static boolean isGenericParamType(Type type) {
<span class="fc bfc" id="L2417" title="All 2 branches covered.">        if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2418">            return true;</span>
        }
<span class="fc bfc" id="L2420" title="All 2 branches covered.">        if (type instanceof Class) {</span>
<span class="fc" id="L2421">            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</span>
<span class="fc bfc" id="L2422" title="All 4 branches covered.">            return superType != Object.class &amp;&amp; isGenericParamType(superType);</span>
        }
<span class="fc" id="L2424">        return false;</span>
    }

    public static Type getGenericParamType(Type type) {
<span class="fc bfc" id="L2428" title="All 2 branches covered.">        if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2429">            return type;</span>
        }
<span class="pc bpc" id="L2431" title="1 of 2 branches missed.">        if (type instanceof Class) {</span>
<span class="fc" id="L2432">            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</span>
        }
<span class="nc" id="L2434">        return type;</span>
    }

    public static Type unwrapOptional(Type type) {
<span class="fc bfc" id="L2438" title="All 2 branches covered.">        if (!optionalClassInited) {</span>
            try {
<span class="fc" id="L2440">                optionalClass = Class.forName(&quot;java.util.Optional&quot;);</span>
<span class="nc" id="L2441">            } catch (Exception e) {</span>
                // skip
            } finally {
<span class="fc" id="L2444">                optionalClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2447" title="1 of 2 branches missed.">        if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2448">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>
<span class="pc bpc" id="L2449" title="1 of 2 branches missed.">            if (parameterizedType.getRawType() == optionalClass) {</span>
<span class="fc" id="L2450">                return parameterizedType.getActualTypeArguments()[0];</span>
            }
        }
<span class="nc" id="L2453">        return type;</span>
    }

    public static Class&lt;?&gt; getClass(Type type) {
<span class="fc bfc" id="L2457" title="All 2 branches covered.">        if (type.getClass() == Class.class) {</span>
<span class="fc" id="L2458">            return (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2461" title="All 2 branches covered.">        if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2462">            return getClass(((ParameterizedType) type).getRawType());</span>
        }

<span class="fc bfc" id="L2465" title="All 2 branches covered.">        if (type instanceof TypeVariable) {</span>
<span class="fc" id="L2466">            Type boundType = ((TypeVariable&lt;?&gt;) type).getBounds()[0];</span>
<span class="pc bpc" id="L2467" title="1 of 2 branches missed.">            if (boundType instanceof Class) {</span>
<span class="fc" id="L2468">                return (Class) boundType;</span>
            }
<span class="nc" id="L2470">            return getClass(boundType);</span>
        }

<span class="pc bpc" id="L2473" title="1 of 2 branches missed.">        if (type instanceof WildcardType) {</span>
<span class="fc" id="L2474">            Type[] upperBounds = ((WildcardType) type).getUpperBounds();</span>
<span class="pc bpc" id="L2475" title="1 of 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="fc" id="L2476">                return getClass(upperBounds[0]);</span>
            }
        }

<span class="nc" id="L2480">        return Object.class;</span>
    }

    public static Field getField(Class&lt;?&gt; clazz, String fieldName, Field[] declaredFields) {
<span class="fc bfc" id="L2484" title="All 2 branches covered.">        for (Field field : declaredFields) {</span>
<span class="fc" id="L2485">            String itemName = field.getName();</span>
<span class="fc bfc" id="L2486" title="All 2 branches covered.">            if (fieldName.equals(itemName)) {</span>
<span class="fc" id="L2487">                return field;</span>
            }

            char c0, c1;
<span class="fc bfc" id="L2491" title="All 2 branches covered.">            if (fieldName.length() &gt; 2</span>
<span class="fc bfc" id="L2492" title="All 4 branches covered.">                    &amp;&amp; (c0 = fieldName.charAt(0)) &gt;= 'a' &amp;&amp; c0 &lt;= 'z'</span>
<span class="fc bfc" id="L2493" title="All 4 branches covered.">                    &amp;&amp; (c1 = fieldName.charAt(1)) &gt;= 'A' &amp;&amp; c1 &lt;= 'Z'</span>
<span class="fc bfc" id="L2494" title="All 2 branches covered.">                    &amp;&amp; fieldName.equalsIgnoreCase(itemName)) {</span>
<span class="fc" id="L2495">                return field;</span>
            }
        }
<span class="fc" id="L2498">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2499" title="All 4 branches covered.">        if (superClass != null &amp;&amp; superClass != Object.class) {</span>
<span class="fc" id="L2500">            return getField(superClass, fieldName, superClass.getDeclaredFields());</span>
        }
<span class="fc" id="L2502">        return null;</span>
    }

    /**
     * @deprecated
     */
    public static int getSerializeFeatures(Class&lt;?&gt; clazz) {
<span class="fc" id="L2509">        JSONType annotation = TypeUtils.getAnnotation(clazz, JSONType.class);</span>
<span class="fc bfc" id="L2510" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L2511">            return 0;</span>
        }
<span class="fc" id="L2513">        return SerializerFeature.of(annotation.serialzeFeatures());</span>
    }

    public static int getParserFeatures(Class&lt;?&gt; clazz) {
<span class="fc" id="L2517">        JSONType annotation = TypeUtils.getAnnotation(clazz, JSONType.class);</span>
<span class="fc bfc" id="L2518" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L2519">            return 0;</span>
        }
<span class="fc" id="L2521">        return Feature.of(annotation.parseFeatures());</span>
    }

    public static String decapitalize(String name) {
<span class="pc bpc" id="L2525" title="2 of 4 branches missed.">        if (name == null || name.length() == 0) {</span>
<span class="nc" id="L2526">            return name;</span>
        }
<span class="fc bfc" id="L2528" title="All 6 branches covered.">        if (name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))) {</span>
<span class="fc" id="L2529">            return name;</span>
        }
<span class="fc" id="L2531">        char[] chars = name.toCharArray();</span>
<span class="fc" id="L2532">        chars[0] = Character.toLowerCase(chars[0]);</span>
<span class="fc" id="L2533">        return new String(chars);</span>
    }

    /**
     * resolve property name from get/set method name
     *
     * @param methodName get/set method name
     * @return property name
     */
    public static String getPropertyNameByMethodName(String methodName) {
<span class="fc" id="L2543">        return Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</span>
    }

    static void setAccessible(AccessibleObject obj) {
<span class="pc bpc" id="L2547" title="1 of 2 branches missed.">        if (!setAccessibleEnable) {</span>
<span class="nc" id="L2548">            return;</span>
        }
<span class="fc bfc" id="L2550" title="All 2 branches covered.">        if (obj.isAccessible()) {</span>
<span class="fc" id="L2551">            return;</span>
        }
        try {
<span class="fc" id="L2554">            obj.setAccessible(true);</span>
<span class="nc" id="L2555">        } catch (Throwable error) {</span>
<span class="nc" id="L2556">            setAccessibleEnable = false;</span>
<span class="fc" id="L2557">        }</span>
<span class="fc" id="L2558">    }</span>

    public static Type getCollectionItemType(Type fieldType) {
<span class="fc bfc" id="L2561" title="All 2 branches covered.">        if (fieldType instanceof ParameterizedType) {</span>
<span class="fc" id="L2562">            return getCollectionItemType((ParameterizedType) fieldType);</span>
        }
<span class="fc bfc" id="L2564" title="All 2 branches covered.">        if (fieldType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2565">            return getCollectionItemType((Class&lt;?&gt;) fieldType);</span>
        }
<span class="fc" id="L2567">        return Object.class;</span>
    }

    private static Type getCollectionItemType(Class&lt;?&gt; clazz) {
<span class="fc bfc" id="L2571" title="All 2 branches covered.">        return clazz.getName().startsWith(&quot;java.&quot;)</span>
                ? Object.class
<span class="fc" id="L2573">                : getCollectionItemType(getCollectionSuperType(clazz));</span>
    }

    private static Type getCollectionItemType(ParameterizedType parameterizedType) {
<span class="fc" id="L2577">        Type rawType = parameterizedType.getRawType();</span>
<span class="fc" id="L2578">        Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span>
<span class="fc bfc" id="L2579" title="All 2 branches covered.">        if (rawType == Collection.class) {</span>
<span class="fc" id="L2580">            return getWildcardTypeUpperBounds(actualTypeArguments[0]);</span>
        }
<span class="fc" id="L2582">        Class&lt;?&gt; rawClass = (Class&lt;?&gt;) rawType;</span>
<span class="fc" id="L2583">        Map&lt;TypeVariable, Type&gt; actualTypeMap = createActualTypeMap(rawClass.getTypeParameters(), actualTypeArguments);</span>
<span class="fc" id="L2584">        Type superType = getCollectionSuperType(rawClass);</span>
<span class="pc bpc" id="L2585" title="1 of 2 branches missed.">        if (superType instanceof ParameterizedType) {</span>
<span class="fc" id="L2586">            Class&lt;?&gt; superClass = getRawClass(superType);</span>
<span class="fc" id="L2587">            Type[] superClassTypeParameters = ((ParameterizedType) superType).getActualTypeArguments();</span>
<span class="pc bpc" id="L2588" title="1 of 2 branches missed.">            return superClassTypeParameters.length &gt; 0</span>
<span class="pc" id="L2589">                    ? getCollectionItemType(makeParameterizedType(superClass, superClassTypeParameters, actualTypeMap))</span>
<span class="nc" id="L2590">                    : getCollectionItemType(superClass);</span>
        }
<span class="nc" id="L2592">        return getCollectionItemType((Class&lt;?&gt;) superType);</span>
    }

    private static Type getCollectionSuperType(Class&lt;?&gt; clazz) {
<span class="fc" id="L2596">        Type assignable = null;</span>
<span class="fc bfc" id="L2597" title="All 2 branches covered.">        for (Type type : clazz.getGenericInterfaces()) {</span>
<span class="fc" id="L2598">            Class&lt;?&gt; rawClass = getRawClass(type);</span>
<span class="fc bfc" id="L2599" title="All 2 branches covered.">            if (rawClass == Collection.class) {</span>
<span class="fc" id="L2600">                return type;</span>
            }
<span class="fc bfc" id="L2602" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(rawClass)) {</span>
<span class="fc" id="L2603">                assignable = type;</span>
            }
        }
<span class="fc bfc" id="L2606" title="All 2 branches covered.">        return assignable == null ? clazz.getGenericSuperclass() : assignable;</span>
    }

    private static Map&lt;TypeVariable, Type&gt; createActualTypeMap(TypeVariable[] typeParameters, Type[] actualTypeArguments) {
<span class="fc" id="L2610">        int length = typeParameters.length;</span>
<span class="fc" id="L2611">        Map&lt;TypeVariable, Type&gt; actualTypeMap = new HashMap&lt;TypeVariable, Type&gt;(length);</span>
<span class="fc bfc" id="L2612" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2613">            actualTypeMap.put(typeParameters[i], actualTypeArguments[i]);</span>
        }
<span class="fc" id="L2615">        return actualTypeMap;</span>
    }

    private static ParameterizedType makeParameterizedType(Class&lt;?&gt; rawClass, Type[] typeParameters, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc" id="L2619">        int length = typeParameters.length;</span>
<span class="fc" id="L2620">        Type[] actualTypeArguments = new Type[length];</span>
<span class="fc bfc" id="L2621" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2622">            actualTypeArguments[i] = getActualType(typeParameters[i], actualTypeMap);</span>
        }
<span class="fc" id="L2624">        return new ParameterizedTypeImpl(actualTypeArguments, null, rawClass);</span>
    }

    private static Type getActualType(Type typeParameter, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc bfc" id="L2628" title="All 2 branches covered.">        if (typeParameter instanceof TypeVariable) {</span>
<span class="fc" id="L2629">            return actualTypeMap.get(typeParameter);</span>
<span class="fc bfc" id="L2630" title="All 2 branches covered.">        } else if (typeParameter instanceof ParameterizedType) {</span>
<span class="fc" id="L2631">            return makeParameterizedType(getRawClass(typeParameter), ((ParameterizedType) typeParameter).getActualTypeArguments(), actualTypeMap);</span>
<span class="fc bfc" id="L2632" title="All 2 branches covered.">        } else if (typeParameter instanceof GenericArrayType) {</span>
<span class="fc" id="L2633">            return new GenericArrayTypeImpl(getActualType(((GenericArrayType) typeParameter).getGenericComponentType(), actualTypeMap));</span>
        }
<span class="fc" id="L2635">        return typeParameter;</span>
    }

    private static Type getWildcardTypeUpperBounds(Type type) {
<span class="fc bfc" id="L2639" title="All 2 branches covered.">        if (type instanceof WildcardType) {</span>
<span class="fc" id="L2640">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="fc" id="L2641">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2642" title="1 of 2 branches missed.">            return upperBounds.length &gt; 0 ? upperBounds[0] : Object.class;</span>
        }
<span class="fc" id="L2644">        return type;</span>
    }

    public static Class&lt;?&gt; getCollectionItemClass(Type fieldType) {
<span class="fc bfc" id="L2648" title="All 2 branches covered.">        if (fieldType instanceof ParameterizedType) {</span>
            Class&lt;?&gt; itemClass;
<span class="fc" id="L2650">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L2651" title="All 2 branches covered.">            if (actualTypeArgument instanceof WildcardType) {</span>
<span class="fc" id="L2652">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L2653">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2654" title="1 of 2 branches missed.">                if (upperBounds.length == 1) {</span>
<span class="fc" id="L2655">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc bfc" id="L2658" title="All 2 branches covered.">            if (actualTypeArgument instanceof Class) {</span>
<span class="fc" id="L2659">                itemClass = (Class&lt;?&gt;) actualTypeArgument;</span>
<span class="fc bfc" id="L2660" title="All 2 branches covered.">                if (!Modifier.isPublic(itemClass.getModifiers())) {</span>
<span class="fc" id="L2661">                    throw new JSONException(&quot;can not create ASMParser&quot;);</span>
                }
            } else {
<span class="fc" id="L2664">                throw new JSONException(&quot;can not create ASMParser&quot;);</span>
            }
<span class="fc" id="L2666">            return itemClass;</span>
        }
<span class="fc" id="L2668">        return Object.class;</span>
    }

<span class="fc" id="L2671">    private static final Map primitiveTypeMap = new HashMap&lt;Class, String&gt;(8) {{</span>
<span class="fc" id="L2672">        put(boolean.class, &quot;Z&quot;);</span>
<span class="fc" id="L2673">        put(char.class, &quot;C&quot;);</span>
<span class="fc" id="L2674">        put(byte.class, &quot;B&quot;);</span>
<span class="fc" id="L2675">        put(short.class, &quot;S&quot;);</span>
<span class="fc" id="L2676">        put(int.class, &quot;I&quot;);</span>
<span class="fc" id="L2677">        put(long.class, &quot;J&quot;);</span>
<span class="fc" id="L2678">        put(float.class, &quot;F&quot;);</span>
<span class="fc" id="L2679">        put(double.class, &quot;D&quot;);</span>
<span class="fc" id="L2680">    }};</span>

    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<span class="fc" id="L2683">        Type clz = genericArrayType;</span>
<span class="fc" id="L2684">        Type genericComponentType = genericArrayType.getGenericComponentType();</span>

<span class="fc" id="L2686">        String prefix = &quot;[&quot;;</span>
<span class="pc bpc" id="L2687" title="1 of 2 branches missed.">        while (genericComponentType instanceof GenericArrayType) {</span>
<span class="nc" id="L2688">            genericComponentType = ((GenericArrayType) genericComponentType)</span>
<span class="nc" id="L2689">                    .getGenericComponentType();</span>
<span class="nc" id="L2690">            prefix += prefix;</span>
        }

<span class="fc bfc" id="L2693" title="All 2 branches covered.">        if (genericComponentType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2694">            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</span>
<span class="pc bpc" id="L2695" title="1 of 2 branches missed.">            if (ck.isPrimitive()) {</span>
                try {
<span class="fc" id="L2697">                    String postfix = (String) primitiveTypeMap.get(ck);</span>
<span class="pc bpc" id="L2698" title="1 of 2 branches missed.">                    if (postfix != null) {</span>
<span class="fc" id="L2699">                        clz = Class.forName(prefix + postfix);</span>
                    }
<span class="nc" id="L2701">                } catch (ClassNotFoundException ignored) {</span>
<span class="fc" id="L2702">                }</span>
            }
        }

<span class="fc" id="L2706">        return clz;</span>
    }

    public static Set createSet(Type type) {
<span class="fc" id="L2710">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Set set;
<span class="pc bpc" id="L2712" title="2 of 4 branches missed.">        if (rawClass == AbstractCollection.class //</span>
                || rawClass == Collection.class) {
<span class="nc" id="L2714">            set = new HashSet();</span>
<span class="fc bfc" id="L2715" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L2716">            set = new HashSet();</span>
<span class="pc bpc" id="L2717" title="1 of 2 branches missed.">        } else if (rawClass.isAssignableFrom(LinkedHashSet.class)) {</span>
<span class="fc" id="L2718">            set = new LinkedHashSet();</span>
<span class="nc bnc" id="L2719" title="All 2 branches missed.">        } else if (rawClass.isAssignableFrom(TreeSet.class)) {</span>
<span class="nc" id="L2720">            set = new TreeSet();</span>
<span class="nc bnc" id="L2721" title="All 2 branches missed.">        } else if (rawClass.isAssignableFrom(EnumSet.class)) {</span>
            Type itemType;
<span class="nc bnc" id="L2723" title="All 2 branches missed.">            if (type instanceof ParameterizedType) {</span>
<span class="nc" id="L2724">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
            } else {
<span class="nc" id="L2726">                itemType = Object.class;</span>
            }
<span class="nc" id="L2728">            set = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="nc" id="L2729">        } else {</span>
            try {
<span class="nc" id="L2731">                set = (Set) rawClass.newInstance();</span>
<span class="nc" id="L2732">            } catch (Exception e) {</span>
<span class="nc" id="L2733">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
<span class="nc" id="L2734">            }</span>
        }
<span class="fc" id="L2736">        return set;</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static Collection createCollection(Type type) {
<span class="fc" id="L2741">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Collection list;
<span class="pc bpc" id="L2743" title="1 of 4 branches missed.">        if (rawClass == AbstractCollection.class //</span>
                || rawClass == Collection.class) {
<span class="fc" id="L2745">            list = new ArrayList();</span>
<span class="fc bfc" id="L2746" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L2747">            list = new HashSet();</span>
<span class="fc bfc" id="L2748" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(LinkedHashSet.class)) {</span>
<span class="fc" id="L2749">            list = new LinkedHashSet();</span>
<span class="fc bfc" id="L2750" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(TreeSet.class)) {</span>
<span class="fc" id="L2751">            list = new TreeSet();</span>
<span class="fc bfc" id="L2752" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(ArrayList.class)) {</span>
<span class="fc" id="L2753">            list = new ArrayList();</span>
<span class="fc bfc" id="L2754" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(EnumSet.class)) {</span>
            Type itemType;
<span class="pc bpc" id="L2756" title="1 of 2 branches missed.">            if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2757">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
            } else {
<span class="nc" id="L2759">                itemType = Object.class;</span>
            }
<span class="fc" id="L2761">            list = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="pc bpc" id="L2762" title="1 of 4 branches missed.">        } else if (rawClass.isAssignableFrom(Queue.class)</span>
<span class="fc bfc" id="L2763" title="All 2 branches covered.">                || (class_deque != null &amp;&amp; rawClass.isAssignableFrom(class_deque))) {</span>
<span class="fc" id="L2764">            list = new LinkedList();</span>
        } else {
            try {
<span class="fc" id="L2767">                list = (Collection) rawClass.newInstance();</span>
<span class="fc" id="L2768">            } catch (Exception e) {</span>
<span class="fc" id="L2769">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
<span class="fc" id="L2770">            }</span>
        }
<span class="fc" id="L2772">        return list;</span>
    }

    public static Class&lt;?&gt; getRawClass(Type type) {
<span class="fc bfc" id="L2776" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2777">            return (Class&lt;?&gt;) type;</span>
<span class="pc bpc" id="L2778" title="1 of 2 branches missed.">        } else if (type instanceof ParameterizedType) {</span>
<span class="fc" id="L2779">            return getRawClass(((ParameterizedType) type).getRawType());</span>
<span class="nc bnc" id="L2780" title="All 2 branches missed.">        } else if (type instanceof WildcardType) {</span>
<span class="nc" id="L2781">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="nc" id="L2782">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="nc bnc" id="L2783" title="All 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="nc" id="L2784">                return getRawClass(upperBounds[0]);</span>
            } else {
<span class="nc" id="L2786">                throw new JSONException(&quot;TODO&quot;);</span>
            }
        } else {
<span class="nc" id="L2789">            throw new JSONException(&quot;TODO&quot;);</span>
        }
    }

<span class="fc" id="L2793">    private static final Set&lt;String&gt; isProxyClassNames = new HashSet&lt;String&gt;(6) {{</span>
<span class="fc" id="L2794">        add(&quot;net.sf.cglib.proxy.Factory&quot;);</span>
<span class="fc" id="L2795">        add(&quot;org.springframework.cglib.proxy.Factory&quot;);</span>
<span class="fc" id="L2796">        add(&quot;javassist.util.proxy.ProxyObject&quot;);</span>
<span class="fc" id="L2797">        add(&quot;org.apache.ibatis.javassist.util.proxy.ProxyObject&quot;);</span>
<span class="fc" id="L2798">        add(&quot;org.hibernate.proxy.HibernateProxy&quot;);</span>
<span class="fc" id="L2799">        add(&quot;org.springframework.context.annotation.ConfigurationClassEnhancer$EnhancedConfiguration&quot;);</span>
<span class="fc" id="L2800">    }};</span>

    public static boolean isProxy(Class&lt;?&gt; clazz) {

<span class="fc bfc" id="L2804" title="All 2 branches covered.">        for (Class&lt;?&gt; item : clazz.getInterfaces()) {</span>
<span class="fc" id="L2805">            String interfaceName = item.getName();</span>
<span class="fc bfc" id="L2806" title="All 2 branches covered.">            if (isProxyClassNames.contains(interfaceName)) {</span>
<span class="fc" id="L2807">                return true;</span>
            }
        }
<span class="fc" id="L2810">        return false;</span>
    }

    public static boolean isTransient(Method method) {
<span class="fc bfc" id="L2814" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2815">            return false;</span>
        }
<span class="fc bfc" id="L2817" title="All 2 branches covered.">        if (!transientClassInited) {</span>
            try {
<span class="fc" id="L2819">                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</span>
<span class="nc" id="L2820">            } catch (Exception e) {</span>
                // skip
            } finally {
<span class="fc" id="L2823">                transientClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2826" title="1 of 2 branches missed.">        if (transientClass != null) {</span>
<span class="fc" id="L2827">            Annotation annotation = TypeUtils.getAnnotation(method, transientClass);</span>
<span class="fc bfc" id="L2828" title="All 2 branches covered.">            return annotation != null;</span>
        }
<span class="nc" id="L2830">        return false;</span>
    }

    public static boolean isAnnotationPresentOneToMany(Method method) {
<span class="fc bfc" id="L2834" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2835">            return false;</span>
        }

<span class="pc bpc" id="L2838" title="1 of 4 branches missed.">        if (class_OneToMany == null &amp;&amp; !class_OneToMany_error) {</span>
            try {
<span class="fc" id="L2840">                class_OneToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.OneToMany&quot;);</span>
<span class="nc" id="L2841">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2843">                class_OneToMany_error = true;</span>
<span class="fc" id="L2844">            }</span>
        }
<span class="pc bpc" id="L2846" title="2 of 4 branches missed.">        return class_OneToMany != null &amp;&amp; method.isAnnotationPresent(class_OneToMany);</span>

    }

    public static boolean isAnnotationPresentManyToMany(Method method) {
<span class="fc bfc" id="L2851" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2852">            return false;</span>
        }

<span class="pc bpc" id="L2855" title="1 of 4 branches missed.">        if (class_ManyToMany == null &amp;&amp; !class_ManyToMany_error) {</span>
            try {
<span class="fc" id="L2857">                class_ManyToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.ManyToMany&quot;);</span>
<span class="nc" id="L2858">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2860">                class_ManyToMany_error = true;</span>
<span class="fc" id="L2861">            }</span>
        }
<span class="pc bpc" id="L2863" title="3 of 6 branches missed.">        return class_ManyToMany != null &amp;&amp; (method.isAnnotationPresent(class_OneToMany) || method.isAnnotationPresent(class_ManyToMany));</span>

    }

    public static boolean isHibernateInitialized(Object object) {
<span class="pc bpc" id="L2868" title="1 of 2 branches missed.">        if (object == null) {</span>
<span class="nc" id="L2869">            return false;</span>
        }
<span class="pc bpc" id="L2871" title="2 of 4 branches missed.">        if (method_HibernateIsInitialized == null &amp;&amp; !method_HibernateIsInitialized_error) {</span>
            try {
<span class="fc" id="L2873">                Class&lt;?&gt; class_Hibernate = Class.forName(&quot;org.hibernate.Hibernate&quot;);</span>
<span class="fc" id="L2874">                method_HibernateIsInitialized = class_Hibernate.getMethod(&quot;isInitialized&quot;, Object.class);</span>
<span class="nc" id="L2875">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2877">                method_HibernateIsInitialized_error = true;</span>
<span class="fc" id="L2878">            }</span>
        }
<span class="pc bpc" id="L2880" title="1 of 2 branches missed.">        if (method_HibernateIsInitialized != null) {</span>
            try {
<span class="fc" id="L2882">                Boolean initialized = (Boolean) method_HibernateIsInitialized.invoke(null, object);</span>
<span class="fc" id="L2883">                return initialized;</span>
<span class="nc" id="L2884">            } catch (Throwable e) {</span>
                // skip
            }
        }
<span class="nc" id="L2888">        return true;</span>
    }

    public static double parseDouble(String str) {
<span class="fc" id="L2892">        final int len = str.length();</span>
<span class="fc bfc" id="L2893" title="All 2 branches covered.">        if (len &gt; 10) {</span>
<span class="fc" id="L2894">            return Double.parseDouble(str);</span>
        }

<span class="fc" id="L2897">        boolean negative = false;</span>

<span class="fc" id="L2899">        long longValue = 0;</span>
<span class="fc" id="L2900">        int scale = 0;</span>
<span class="fc bfc" id="L2901" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2902">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2903" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2904">                negative = true;</span>
<span class="fc" id="L2905">                continue;</span>
            }

<span class="fc bfc" id="L2908" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2909" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2910">                    return Double.parseDouble(str);</span>
                }
<span class="fc" id="L2912">                scale = len - i - 1;</span>
<span class="fc" id="L2913">                continue;</span>
            }

<span class="pc bpc" id="L2916" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2917">                int digit = ch - '0';</span>
<span class="fc" id="L2918">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2919">            } else {</span>
<span class="fc" id="L2920">                return Double.parseDouble(str);</span>
            }
        }

<span class="fc bfc" id="L2924" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2925">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2928" title="2 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2930">                return (double) longValue;</span>
            case 1:
<span class="fc" id="L2932">                return ((double) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2934">                return ((double) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2936">                return ((double) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L2938">                return ((double) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L2940">                return ((double) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L2942">                return ((double) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L2944">                return ((double) longValue) / 10000000;</span>
            case 8:
<span class="fc" id="L2946">                return ((double) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L2948">                return ((double) longValue) / 1000000000;</span>
        }

<span class="nc" id="L2951">        return Double.parseDouble(str);</span>
    }

    public static float parseFloat(String str) {
<span class="fc" id="L2955">        final int len = str.length();</span>
<span class="fc bfc" id="L2956" title="All 2 branches covered.">        if (len &gt;= 10) {</span>
<span class="fc" id="L2957">            return Float.parseFloat(str);</span>
        }

<span class="fc" id="L2960">        boolean negative = false;</span>

<span class="fc" id="L2962">        long longValue = 0;</span>
<span class="fc" id="L2963">        int scale = 0;</span>
<span class="fc bfc" id="L2964" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2965">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2966" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2967">                negative = true;</span>
<span class="fc" id="L2968">                continue;</span>
            }

<span class="fc bfc" id="L2971" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2972" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2973">                    return Float.parseFloat(str);</span>
                }
<span class="fc" id="L2975">                scale = len - i - 1;</span>
<span class="fc" id="L2976">                continue;</span>
            }

<span class="pc bpc" id="L2979" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2980">                int digit = ch - '0';</span>
<span class="fc" id="L2981">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2982">            } else {</span>
<span class="fc" id="L2983">                return Float.parseFloat(str);</span>
            }
        }

<span class="fc bfc" id="L2987" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2988">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2991" title="3 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2993">                return (float) longValue;</span>
            case 1:
<span class="fc" id="L2995">                return ((float) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2997">                return ((float) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2999">                return ((float) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L3001">                return ((float) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L3003">                return ((float) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L3005">                return ((float) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L3007">                return ((float) longValue) / 10000000;</span>
            case 8:
<span class="nc" id="L3009">                return ((float) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L3011">                return ((float) longValue) / 1000000000;</span>
        }

<span class="nc" id="L3014">        return Float.parseFloat(str);</span>
    }

    public static final long fnv1a_64_magic_hashcode = 0xcbf29ce484222325L;
    public static final long fnv1a_64_magic_prime = 0x100000001b3L;

    public static long fnv1a_64_extract(String key) {
<span class="fc" id="L3021">        long hashCode = fnv1a_64_magic_hashcode;</span>
<span class="fc bfc" id="L3022" title="All 2 branches covered.">        for (int i = 0; i &lt; key.length(); ++i) {</span>
<span class="fc" id="L3023">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L3024" title="All 4 branches covered.">            if (ch == '_' || ch == '-') {</span>
<span class="fc" id="L3025">                continue;</span>
            }
<span class="fc bfc" id="L3027" title="All 4 branches covered.">            if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z') {</span>
<span class="fc" id="L3028">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L3030">            hashCode ^= ch;</span>
<span class="fc" id="L3031">            hashCode *= fnv1a_64_magic_prime;</span>
        }
<span class="fc" id="L3033">        return hashCode;</span>
    }

    public static long fnv1a_64_lower(String key) {
<span class="fc" id="L3037">        long hashCode = fnv1a_64_magic_hashcode;</span>
<span class="fc bfc" id="L3038" title="All 2 branches covered.">        for (int i = 0; i &lt; key.length(); ++i) {</span>
<span class="fc" id="L3039">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L3040" title="All 4 branches covered.">            if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z') {</span>
<span class="fc" id="L3041">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L3043">            hashCode ^= ch;</span>
<span class="fc" id="L3044">            hashCode *= fnv1a_64_magic_prime;</span>
        }
<span class="fc" id="L3046">        return hashCode;</span>
    }

    public static long fnv1a_64(String key) {
<span class="fc" id="L3050">        long hashCode = fnv1a_64_magic_hashcode;</span>
<span class="fc bfc" id="L3051" title="All 2 branches covered.">        for (int i = 0; i &lt; key.length(); ++i) {</span>
<span class="fc" id="L3052">            char ch = key.charAt(i);</span>
<span class="fc" id="L3053">            hashCode ^= ch;</span>
<span class="fc" id="L3054">            hashCode *= fnv1a_64_magic_prime;</span>
        }
<span class="fc" id="L3056">        return hashCode;</span>
    }

    public static boolean isKotlin(Class clazz) {
<span class="pc bpc" id="L3060" title="1 of 4 branches missed.">        if (kotlin_metadata == null &amp;&amp; !kotlin_metadata_error) {</span>
            try {
<span class="fc" id="L3062">                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</span>
<span class="nc" id="L3063">            } catch (Throwable e) {</span>
<span class="nc" id="L3064">                kotlin_metadata_error = true;</span>
<span class="fc" id="L3065">            }</span>
        }
<span class="pc bpc" id="L3067" title="1 of 4 branches missed.">        return kotlin_metadata != null &amp;&amp; clazz.isAnnotationPresent(kotlin_metadata);</span>
    }

    public static Constructor getKotlinConstructor(Constructor[] constructors) {
<span class="fc" id="L3071">        return getKotlinConstructor(constructors, null);</span>
    }

    public static Constructor getKotlinConstructor(Constructor[] constructors, String[] paramNames) {
<span class="fc" id="L3075">        Constructor creatorConstructor = null;</span>
<span class="fc bfc" id="L3076" title="All 2 branches covered.">        for (Constructor&lt;?&gt; constructor : constructors) {</span>
<span class="fc" id="L3077">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
<span class="fc bfc" id="L3078" title="All 4 branches covered.">            if (paramNames != null &amp;&amp; parameterTypes.length != paramNames.length) {</span>
<span class="fc" id="L3079">                continue;</span>
            }

<span class="fc bfc" id="L3082" title="All 4 branches covered.">            if (parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)) {</span>
<span class="fc" id="L3083">                continue;</span>
            }
<span class="fc bfc" id="L3085" title="All 4 branches covered.">            if (creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length) {</span>
<span class="fc" id="L3086">                continue;</span>
            }
<span class="fc" id="L3088">            creatorConstructor = constructor;</span>
        }
<span class="fc" id="L3090">        return creatorConstructor;</span>
    }

    public static String[] getKoltinConstructorParameters(Class clazz) {
<span class="pc bpc" id="L3094" title="1 of 4 branches missed.">        if (kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try {
<span class="fc" id="L3096">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L3097">                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</span>
<span class="nc" id="L3098">            } catch (Throwable e) {</span>
<span class="nc" id="L3099">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L3100">            }</span>
        }
<span class="pc bpc" id="L3102" title="1 of 2 branches missed.">        if (kotlin_kclass_constructor == null) {</span>
<span class="nc" id="L3103">            return null;</span>
        }

<span class="pc bpc" id="L3106" title="1 of 4 branches missed.">        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try {
<span class="fc" id="L3108">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L3109">                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</span>
<span class="nc" id="L3110">            } catch (Throwable e) {</span>
<span class="nc" id="L3111">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L3112">            }</span>
        }

<span class="pc bpc" id="L3115" title="1 of 4 branches missed.">        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try {
<span class="fc" id="L3117">                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</span>
<span class="fc" id="L3118">                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</span>
<span class="nc" id="L3119">            } catch (Throwable e) {</span>
<span class="nc" id="L3120">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L3121">            }</span>
        }

<span class="pc bpc" id="L3124" title="1 of 4 branches missed.">        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try {
<span class="fc" id="L3126">                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</span>
<span class="fc" id="L3127">                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</span>
<span class="nc" id="L3128">            } catch (Throwable e) {</span>
<span class="nc" id="L3129">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L3130">            }</span>
        }

<span class="pc bpc" id="L3133" title="1 of 2 branches missed.">        if (kotlin_error) {</span>
<span class="nc" id="L3134">            return null;</span>
        }

        try {
<span class="fc" id="L3138">            Object constructor = null;</span>
<span class="fc" id="L3139">            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</span>
<span class="fc" id="L3140">            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</span>
<span class="fc bfc" id="L3141" title="All 2 branches covered.">            for (Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()) {</span>
<span class="fc" id="L3142">                Object item = iterator.next();</span>
<span class="fc" id="L3143">                List parameters = (List) kotlin_kfunction_getParameters.invoke(item);</span>
<span class="fc bfc" id="L3144" title="All 4 branches covered.">                if (constructor != null &amp;&amp; parameters.size() == 0) {</span>
<span class="fc" id="L3145">                    continue;</span>
                }
<span class="fc" id="L3147">                constructor = item;</span>
            }

<span class="pc bpc" id="L3150" title="1 of 2 branches missed.">            if (constructor == null) {</span>
<span class="nc" id="L3151">                return null;</span>
            }

<span class="fc" id="L3154">            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</span>
<span class="fc" id="L3155">            String[] names = new String[parameters.size()];</span>
<span class="fc bfc" id="L3156" title="All 2 branches covered.">            for (int i = 0; i &lt; parameters.size(); i++) {</span>
<span class="fc" id="L3157">                Object param = parameters.get(i);</span>
<span class="fc" id="L3158">                names[i] = (String) kotlin_kparameter_getName.invoke(param);</span>
            }
<span class="fc" id="L3160">            return names;</span>
<span class="nc" id="L3161">        } catch (Throwable e) {</span>
<span class="nc" id="L3162">            e.printStackTrace();</span>
<span class="nc" id="L3163">            kotlin_error = true;</span>
        }
<span class="nc" id="L3165">        return null;</span>
    }

    private static boolean isKotlinIgnore(Class clazz, String methodName) {
<span class="pc bpc" id="L3169" title="1 of 4 branches missed.">        if (kotlinIgnores == null &amp;&amp; !kotlinIgnores_error) {</span>
            try {
<span class="fc" id="L3171">                Map&lt;Class, String[]&gt; map = new HashMap&lt;Class, String[]&gt;();</span>
<span class="fc" id="L3172">                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</span>
<span class="fc" id="L3173">                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3174">                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</span>
<span class="fc" id="L3175">                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3176">                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</span>
<span class="fc" id="L3177">                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3178">                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</span>
<span class="fc" id="L3179">                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3180">                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</span>
<span class="fc" id="L3181">                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3182">                kotlinIgnores = map;</span>
<span class="nc" id="L3183">            } catch (Throwable error) {</span>
<span class="nc" id="L3184">                kotlinIgnores_error = true;</span>
<span class="fc" id="L3185">            }</span>
        }
<span class="pc bpc" id="L3187" title="1 of 2 branches missed.">        if (kotlinIgnores == null) {</span>
<span class="nc" id="L3188">            return false;</span>
        }
<span class="fc" id="L3190">        String[] ignores = kotlinIgnores.get(clazz);</span>
<span class="fc bfc" id="L3191" title="All 4 branches covered.">        return ignores != null &amp;&amp; Arrays.binarySearch(ignores, methodName) &gt;= 0;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; targetClass, Class&lt;A&gt; annotationClass) {
<span class="fc" id="L3195">        A targetAnnotation = targetClass.getAnnotation(annotationClass);</span>

<span class="fc" id="L3197">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3198">        Type type = JSON.getMixInAnnotations(targetClass);</span>
<span class="fc bfc" id="L3199" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3200">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3203" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3204">            A mixInAnnotation = mixInClass.getAnnotation(annotationClass);</span>
<span class="fc" id="L3205">            Annotation[] annotations = mixInClass.getAnnotations();</span>
<span class="pc bpc" id="L3206" title="1 of 4 branches missed.">            if (mixInAnnotation == null &amp;&amp; annotations.length &gt; 0) {</span>
<span class="nc bnc" id="L3207" title="All 2 branches missed.">                for (Annotation annotation : annotations) {</span>
<span class="nc" id="L3208">                    mixInAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="nc bnc" id="L3209" title="All 2 branches missed.">                    if (mixInAnnotation != null) {</span>
<span class="nc" id="L3210">                        break;</span>
                    }
                }
            }
<span class="fc bfc" id="L3214" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3215">                return mixInAnnotation;</span>
            }
        }

<span class="fc" id="L3219">        Annotation[] targetClassAnnotations = targetClass.getAnnotations();</span>
<span class="fc bfc" id="L3220" title="All 4 branches covered.">        if (targetAnnotation == null &amp;&amp; targetClassAnnotations.length &gt; 0) {</span>
<span class="fc bfc" id="L3221" title="All 2 branches covered.">            for (Annotation annotation : targetClassAnnotations) {</span>
<span class="fc" id="L3222">                targetAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L3223" title="1 of 2 branches missed.">                if (targetAnnotation != null) {</span>
<span class="nc" id="L3224">                    break;</span>
                }
            }
        }
<span class="fc" id="L3228">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Field field, Class&lt;A&gt; annotationClass) {
<span class="fc" id="L3232">        A targetAnnotation = field.getAnnotation(annotationClass);</span>

<span class="fc" id="L3234">        Class&lt;?&gt; clazz = field.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L3236">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3237">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3238" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3239">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3242" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3243">            Field mixInField = null;</span>
<span class="fc" id="L3244">            String fieldName = field.getName();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="fc bfc" id="L3246" title="All 4 branches covered.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L3247">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L3249">                    mixInField = currClass.getDeclaredField(fieldName);</span>
<span class="fc" id="L3250">                    break;</span>
<span class="fc" id="L3251">                } catch (NoSuchFieldException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L3255" title="All 2 branches covered.">            if (mixInField == null) {</span>
<span class="fc" id="L3256">                return targetAnnotation;</span>
            }
<span class="fc" id="L3258">            mixInAnnotation = mixInField.getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L3259" title="1 of 2 branches missed.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3260">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L3263">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Method method, Class&lt;A&gt; annotationClass) {
<span class="fc" id="L3267">        A targetAnnotation = method.getAnnotation(annotationClass);</span>

<span class="fc" id="L3269">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L3271">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3272">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3273" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3274">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3277" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3278">            Method mixInMethod = null;</span>
<span class="fc" id="L3279">            String methodName = method.getName();</span>
<span class="fc" id="L3280">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="fc bfc" id="L3282" title="All 4 branches covered.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L3283">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L3285">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="fc" id="L3286">                    break;</span>
<span class="fc" id="L3287">                } catch (NoSuchMethodException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L3291" title="All 2 branches covered.">            if (mixInMethod == null) {</span>
<span class="fc" id="L3292">                return targetAnnotation;</span>
            }
<span class="fc" id="L3294">            mixInAnnotation = mixInMethod.getAnnotation(annotationClass);</span>
<span class="fc bfc" id="L3295" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3296">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L3299">        return targetAnnotation;</span>
    }

    public static Annotation[][] getParameterAnnotations(Method method) {
<span class="fc" id="L3303">        Annotation[][] targetAnnotations = method.getParameterAnnotations();</span>

<span class="fc" id="L3305">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3307">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3308">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="pc bpc" id="L3309" title="1 of 2 branches missed.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="nc" id="L3310">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="pc bpc" id="L3313" title="1 of 2 branches missed.">        if (mixInClass != null) {</span>
<span class="nc" id="L3314">            Method mixInMethod = null;</span>
<span class="nc" id="L3315">            String methodName = method.getName();</span>
<span class="nc" id="L3316">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="nc bnc" id="L3318" title="All 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="nc" id="L3319">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="nc" id="L3321">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="nc" id="L3322">                    break;</span>
<span class="nc" id="L3323">                } catch (NoSuchMethodException e) {</span>
<span class="nc" id="L3324">                    continue;</span>
                }
            }
<span class="nc bnc" id="L3327" title="All 2 branches missed.">            if (mixInMethod == null) {</span>
<span class="nc" id="L3328">                return targetAnnotations;</span>
            }
<span class="nc" id="L3330">            mixInAnnotations = mixInMethod.getParameterAnnotations();</span>
<span class="nc bnc" id="L3331" title="All 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="nc" id="L3332">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3335">        return targetAnnotations;</span>
    }

    public static Annotation[][] getParameterAnnotations(Constructor constructor) {
<span class="fc" id="L3339">        Annotation[][] targetAnnotations = constructor.getParameterAnnotations();</span>

<span class="fc" id="L3341">        Class&lt;?&gt; clazz = constructor.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3343">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3344">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3345" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3346">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3349" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3350">            Constructor mixInConstructor = null;</span>
<span class="fc" id="L3351">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
            // 构建参数列表，因为内部类的构造函数需要传入外部类的引用
<span class="fc" id="L3353">            List&lt;Class&lt;?&gt;&gt; enclosingClasses = new ArrayList&lt;Class&lt;?&gt;&gt;(2);</span>
<span class="fc bfc" id="L3354" title="All 2 branches covered.">            for (Class&lt;?&gt; enclosingClass = mixInClass.getEnclosingClass(); enclosingClass != null; enclosingClass = enclosingClass.getEnclosingClass()) {</span>
<span class="fc" id="L3355">                enclosingClasses.add(enclosingClass);</span>
            }
<span class="fc" id="L3357">            int level = enclosingClasses.size();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="pc bpc" id="L3359" title="1 of 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L3360">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="pc bpc" id="L3362" title="1 of 2 branches missed.">                    if (level != 0) {</span>
<span class="fc" id="L3363">                        Class&lt;?&gt;[] outerClassAndParameterTypes = new Class[level + parameterTypes.length];</span>
<span class="fc" id="L3364">                        System.arraycopy(parameterTypes, 0, outerClassAndParameterTypes, level, parameterTypes.length);</span>
<span class="fc bfc" id="L3365" title="All 2 branches covered.">                        for (int i = level; i &gt; 0; i--) {</span>
<span class="fc" id="L3366">                            outerClassAndParameterTypes[i - 1] = enclosingClasses.get(i - 1);</span>
                        }
<span class="fc" id="L3368">                        mixInConstructor = mixInClass.getDeclaredConstructor(outerClassAndParameterTypes);</span>
<span class="fc" id="L3369">                    } else {</span>
<span class="nc" id="L3370">                        mixInConstructor = mixInClass.getDeclaredConstructor(parameterTypes);</span>
                    }
<span class="fc" id="L3372">                    break;</span>
<span class="fc" id="L3373">                } catch (NoSuchMethodException e) {</span>
<span class="fc" id="L3374">                    level--;</span>
                }
            }
<span class="fc bfc" id="L3377" title="All 2 branches covered.">            if (mixInConstructor == null) {</span>
<span class="fc" id="L3378">                return targetAnnotations;</span>
            }
<span class="fc" id="L3380">            mixInAnnotations = mixInConstructor.getParameterAnnotations();</span>
<span class="pc bpc" id="L3381" title="1 of 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="fc" id="L3382">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3385">        return targetAnnotations;</span>
    }

    public static boolean isJacksonCreator(Method method) {
<span class="pc bpc" id="L3389" title="1 of 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L3390">            return false;</span>
        }

<span class="pc bpc" id="L3393" title="1 of 4 branches missed.">        if (class_JacksonCreator == null &amp;&amp; !class_JacksonCreator_error) {</span>
            try {
<span class="fc" id="L3395">                class_JacksonCreator = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;com.fasterxml.jackson.annotation.JsonCreator&quot;);</span>
<span class="nc" id="L3396">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L3398">                class_JacksonCreator_error = true;</span>
<span class="fc" id="L3399">            }</span>
        }
<span class="pc bpc" id="L3401" title="1 of 4 branches missed.">        return class_JacksonCreator != null &amp;&amp; method.isAnnotationPresent(class_JacksonCreator);</span>
    }

    private static Object OPTIONAL_EMPTY;
<span class="fc" id="L3405">    private static boolean OPTIONAL_ERROR = false;</span>

    public static Object optionalEmpty(Type type) {
<span class="pc bpc" id="L3408" title="1 of 2 branches missed.">        if (OPTIONAL_ERROR) {</span>
<span class="nc" id="L3409">            return null;</span>
        }

<span class="fc" id="L3412">        Class clazz = getClass(type);</span>
<span class="pc bpc" id="L3413" title="1 of 2 branches missed.">        if (clazz == null) {</span>
<span class="nc" id="L3414">            return null;</span>
        }

<span class="fc" id="L3417">        String className = clazz.getName();</span>

<span class="fc bfc" id="L3419" title="All 2 branches covered.">        if (&quot;java.util.Optional&quot;.equals(className)) {</span>
<span class="fc bfc" id="L3420" title="All 2 branches covered.">            if (OPTIONAL_EMPTY == null) {</span>
                try {
<span class="fc" id="L3422">                    Method empty = Class.forName(className).getMethod(&quot;empty&quot;);</span>
<span class="fc" id="L3423">                    OPTIONAL_EMPTY = empty.invoke(null);</span>
<span class="nc" id="L3424">                } catch (Throwable e) {</span>
<span class="nc" id="L3425">                    OPTIONAL_ERROR = true;</span>
<span class="fc" id="L3426">                }</span>
            }
<span class="fc" id="L3428">            return OPTIONAL_EMPTY;</span>
        }
<span class="fc" id="L3430">        return null;</span>
    }

<span class="fc" id="L3433">    public static class MethodInheritanceComparator implements Comparator&lt;Method&gt; {</span>
        public int compare(Method m1, Method m2) {
<span class="fc" id="L3435">            int cmp = m1.getName().compareTo(m2.getName());</span>
<span class="fc bfc" id="L3436" title="All 2 branches covered.">            if (cmp != 0) {</span>
<span class="fc" id="L3437">                return cmp;</span>
            }

<span class="fc" id="L3440">            Class&lt;?&gt; class1 = m1.getReturnType();</span>
<span class="fc" id="L3441">            Class&lt;?&gt; class2 = m2.getReturnType();</span>

<span class="fc bfc" id="L3443" title="All 2 branches covered.">            if (class1.equals(class2)) {</span>
<span class="fc" id="L3444">                return 0;</span>
            }

<span class="fc bfc" id="L3447" title="All 2 branches covered.">            if (class1.isAssignableFrom(class2)) {</span>
<span class="fc" id="L3448">                return -1;</span>
            }
            
<span class="fc bfc" id="L3451" title="All 2 branches covered.">            if (class2.isAssignableFrom(class1)) {</span>
<span class="fc" id="L3452">                return 1;</span>
            }
<span class="fc" id="L3454">            return 0;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>